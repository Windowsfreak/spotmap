/*! spotmap - v0.1.0 - 2017-05-25
* https://github.com/windowsfreak/spotmap
* Copyright (c) 2017 BjÃ¶rn Eberhardt; Licensed MIT */
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a};!function(a){a.ready=[],a.runLater=function(){return(a.ready=a.ready.map(function(a){return"function"==typeof a&&a()}).filter(function(a){return a})).length&&a.runLater()},a._=function(a){return"#"===a[0]?document.getElementById(a.slice(1)):document.querySelectorAll(a)},a.strip=function(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""},a.t=function(a,b){return lang[a]||console.log("MISSING: "+a),lang[a]?lang[a].replace("\\1",b):"MISSING: "+a},a.setLang=function(a){localStorage.setItem("lang",a),location.reload()},a.t_html=function(){var b=!0,c=!1,d=void 0;try{for(var e,f=a._("*")[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;g.getAttribute("data-translate")&&(g[["input","textarea"].indexOf(g.tagName.toLowerCase())>=0?"placeholder":"innerHTML"]=a.t(g.getAttribute("data-translate")))}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}},a.t_html()}(window);var Form={};!function(a){ready.push(function(){Nav.events.form_show=function(){_("#map").style.display="block",_("#map").className="half",Maps.map.setCenter(Maps.marker.getPosition()),google.maps.event.trigger(Maps.map,"resize"),google.maps.event.addListenerOnce(Maps.map,"idle",function(){google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(Maps.marker.getPosition())})},Nav.events.form_hide=function(a){_("#map").className="",localStorage.getItem("form_text")&&!a&&Nav.success(t("draft_saved"))}}),a.add_here=function(b){Maps.newMarker(Spot.spot,!0),a.add(b)},a.add=function(a){var b={spot:t("new_spot"),group:t("new_group"),event:t("new_event")};_("#form-type").innerText=b[a],Spot.marker={lat:Maps.marker.getPosition().lat(),lng:Maps.marker.getPosition().lng(),type:a},Nav.goTab("form")},a.backup=function(){localStorage.setItem("form_title",_("#form-title").value),localStorage.setItem("form_text",_("#form-text").value),localStorage.setItem("form_lat",Maps.marker.getPosition().lat()),localStorage.setItem("form_lng",Maps.marker.getPosition().lng()),Spot.marker&&localStorage.setItem("form_type",Spot.marker.type)},a.restore=function(){localStorage.getItem("form_text")&&(_("#form-title").value=localStorage.getItem("form_title"),_("#form-text").value=localStorage.getItem("form_text"),Spot.marker={lat:parseFloat(localStorage.getItem("form_lat")),lng:parseFloat(localStorage.getItem("form_lng")),type:localStorage.getItem("form_type")},window.panToPosition=!1,Maps.newMarker(Spot.marker,!0),Maps.map.panTo(Spot.marker),a.add(Spot.marker.type),google.maps.event.addListenerOnce(Maps.map,"idle",function(){Maps.map.panTo(Maps.marker.getPosition())}),Nav.success(t("draft_restored")))},a.remove=function(a){(a||confirm(t("draft_delete_confirm")))&&(localStorage.removeItem("form_title"),localStorage.removeItem("form_text"),localStorage.removeItem("form_lat"),localStorage.removeItem("form_lng"),localStorage.removeItem("form_type"),_("#form-title").value="",_("#form-text").value="",Nav.goTab("map",0),a||Nav.success(t("draft_deleted")))},a.save=function(){Http.get("//www.parkour.org/rest/session/token",void 0,{Authorization:!1}).then(function(b){Nav.success(t("in_progress")),Http.post("//www.parkour.org/entity/node?_format=hal_json",JSON.stringify({_links:{type:{href:"https://www.parkour.org/rest/type/node/"+Spot.marker.type}},type:[{target_id:Spot.marker.type}],title:[{value:_("#form-title").value}],body:[{value:_("#form-text").value}],field_location:[{lat:Spot.marker.lat,lon:Spot.marker.lng,value:"POINT ("+Spot.marker.lng+" "+Spot.marker.lat+")"}]}),{"Content-Type":"application/hal+json","X-CSRF-Token":b.message}).then(function(b){Nav.success(t("node_added")),location.href="//www.parkour.org/de/node/"+Spot.find("nid|\\d+|value",b)[0]+"/edit",a.remove(!0)},function(a){return Nav.error(t(403===a.status||401===a.status?"error_forbidden":"error_add_node"))})},function(){return Nav.error(t("error_add_node"))})}}(Form);var Geohash={};!function(a){a.BITS=[16,8,4,2,1],a.BASE32="0123456789bcdefghjkmnpqrstuvwxyz",a.NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}},a.BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}},a.NEIGHBORS.bottom.odd=a.NEIGHBORS.left.even,a.NEIGHBORS.top.odd=a.NEIGHBORS.right.even,a.NEIGHBORS.left.odd=a.NEIGHBORS.bottom.even,a.NEIGHBORS.right.odd=a.NEIGHBORS.top.even,a.BORDERS.bottom.odd=a.BORDERS.left.even,a.BORDERS.top.odd=a.BORDERS.right.even,a.BORDERS.left.odd=a.BORDERS.bottom.even,a.BORDERS.right.odd=a.BORDERS.top.even,a.refineInterval=function(a,b,c){return a[b&c?0:1]=(a[0]+a[1])/2},a.adjacent=function(b,c){b=b.toLowerCase();var d=b.charAt(b.length-1),e=b.length%2?"odd":"even",f=b.substring(0,b.length-1);return(a.BORDERS[c][e].indexOf(d)!==-1?a.adjacent(f,c):f)+a.BASE32[a.NEIGHBORS[c][e].indexOf(d)]},a.decode=function(b){var c=1,d=[],e=[];d[0]=-90,d[1]=90,e[0]=-180,e[1]=180;for(var f=90,g=180,h=0;h<b.length;h++)for(var i=b[h],j=a.BASE32.indexOf(i),k=0;k<5;k++){var l=a.BITS[k];c?(g/=2,a.refineInterval(e,j,l)):(f/=2,a.refineInterval(d,j,l)),c=!c}return d[2]=(d[0]+d[1])/2,e[2]=(e[0]+e[1])/2,{lat:d,lng:e}},a.encode=function(b,c){var d=1,e=[],f=[],g=0,h=0,i=12,j="";for(e[0]=-90,e[1]=90,f[0]=-180,f[1]=180;j.length<i;){if(d){var k=(f[0]+f[1])/2;c>k?(h|=a.BITS[g],f[0]=k):f[1]=k}else{var l=(e[0]+e[1])/2;b>l?(h|=a.BITS[g],e[0]=l):e[1]=l}d=!d,g<4?g++:(j+=a.BASE32[h],g=0,h=0)}return j}}(Geohash);var Geotile={};!function(a){var b={},c=[[180,360],[45,45],[5.625,11.25],[1.40625,1.40625],[.17578125,.3515625],[.0439453125,.0439453125],[.0054931640625,.010986328125],[.001373291015625,.001373291015625],[.000171661376953125,.00034332275390625],[4291534423828125e-20,4291534423828125e-20],[5364418029785156e-21,10728836059570312e-21],[1341104507446289e-21,1341104507446289e-21],[1.6763806343078613e-7,3.3527612686157227e-7]];a.onlyUnique=function(a,b,c){return c.indexOf(a)===b},a.extend=function(b,c){var d=b.slice(0),e=!0,f=!1,g=void 0;try{for(var h,i=d[Symbol.iterator]();!(e=(h=i.next()).done);e=!0){var j=h.value;b.push(Geohash.adjacent(j,c))}}catch(a){f=!0,g=a}finally{try{!e&&i.return&&i.return()}finally{if(f)throw g}}return b.filter(a.onlyUnique)},a.filter=function(a,b){var c={};for(var d in a)if(a.hasOwnProperty(d)){var e=b(d,a[d]);void 0!==e&&(c[d]=e)}return c},a.loadBounds=function(d,e){var f=void 0;d.lat?f=d:(f={sw:d.getSouthWest(),ne:d.getNorthEast()},f={lat:[f.sw.lat(),f.ne.lat()],lng:[f.sw.lng(),f.ne.lng()]});var g={lat:f.lat.slice(0),lng:f.lng.slice(0)};g.lng[1]<g.lng[0]&&(g.lng[1]+=360),g.lng[0]+g.lng[1]>360&&(g.lng[1]-=360,g.lng[0]-=360);var h=[g.lat[1]-g.lat[0],g.lng[1]-g.lng[0]],i=void 0,j=Math.min(h[0],h[1]);i=j>23?0:j>2.8?1:j>.7?2:j>.087?3:j>.022?4:j>.0027?5:6,(i>5||i<0)&&(i=-1);for(var k=12;k-- >0&&!(c[k][0]>h[0]/3&&c[k][1]>h[1]/3););k++;for(var l=void 0;k>0;){k--;var m=c[k],n=Geohash.encode((g.lat[0]+g.lat[1])/2,(g.lng[0]+g.lng[1])/2),o=n.substring(0,k);l=[o];var p=Geohash.decode(o);if(p.lat[0]>f.lat[0]){if(p.lat[0]-m[0]>f.lat[0])continue;l=a.extend(l,"bottom")}if(p.lat[1]<f.lat[1]){if(p.lat[1]+m[0]<f.lat[1])continue;l=a.extend(l,"top")}if(p.lng[0]>f.lng[0]){if(p.lng[0]-m[1]>f.lng[0])continue;l=a.extend(l,"left")}if(p.lng[1]<f.lng[1]){if(p.lng[1]+m[1]<f.lng[1])continue;l=a.extend(l,"right")}break}b[i]||(b[i]={});var q={},r=!0,s=!1,u=void 0;try{for(var v,w=l[Symbol.iterator]();!(r=(v=w.next()).done);r=!0){var x=v.value;q[x]=b[i][x]}}catch(a){s=!0,u=a}finally{try{!r&&w.return&&w.return()}finally{if(s)throw u}}var y=Object.keys(a.filter(q,function(a,b){return void 0===b?a:void 0})).map(function(a){return a});return y.length&&Http.get("//www.parkour.org/map/query5j.php",{tiles:y.join(","),zoom:i},{Authorization:!1}).then(function(a){Object.assign(b[i],a),Object.assign(q,a),e(q)},function(){return Nav.error(t("error_load_spotmap"))}),e(q),q}}(Geotile);var Help={};!function(a){ready.push(function(){return Nav.events.help_show=function(b){return a.previous="help"!==b?b:a.previous}}),a.show=function(a){Http.get("./static/"+a+"_"+l+".json",void 0,{Authorization:!1}).then(function(a){_("#help-title").innerText=t("no_title");var b=!0,c=!1,d=void 0;try{for(var e,f=Spot.find("title",a)[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;_("#help-title").innerText=g}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}_("#help-body").innerText=t("no_body");var h=!0,i=!1,j=void 0;try{for(var k,l=Spot.find("body",a)[Symbol.iterator]();!(h=(k=l.next()).done);h=!0){var m=k.value;_("#help-body").innerHTML=m}}catch(a){i=!0,j=a}finally{try{!h&&l.return&&l.return()}finally{if(i)throw j}}Nav.goTab("help")},function(a){return Nav.error(t("no_results_found"))})}}(Help);var Http={};!function(a){a.b64a=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))},a.getUser=function(){return localStorage.getItem("d8_user")},a.getCredentials=function(){return localStorage.getItem("d8_auth")||"Basic Og=="},a.setCredentials=function(b,c){localStorage.setItem("d8_user",b),localStorage.setItem("d8_auth","Basic "+a.b64a(b+":"+c))},a.deleteCredentials=function(){localStorage.removeItem("d8_user"),localStorage.removeItem("d8_auth")},a.http=function(b,c,d){var e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return e.Authorization===!1?delete e.Authorization:e.user?(e.Authorization="Basic "+a.b64a(e.user+":"+e.pass),delete e.user,delete e.pass):c.match(/^(https?:)?\/\/(www\.)parkour\.org\/?/)&&(e.Authorization=a.getCredentials()),new Promise(function(a,f){var g=new XMLHttpRequest;g.open(b,c),g.onload=function(){if(this.status>=200&&this.status<300)try{a(JSON.parse(g.response))}catch(f){Nav.error(t("error_server_request")),a({method:b,url:c,params:d,headers:e,status:this.status,statusText:g.statusText,message:g.response})}else g.onerror()},g.onerror=function(){Nav.error(t("error_server_request"));var a={method:b,url:c,params:d,headers:e,status:this.status,statusText:g.statusText,message:g.response};f(a)},e&&Object.keys(e).forEach(function(a){return g.setRequestHeader(a,e[a])}),d&&"object"===("undefined"==typeof d?"undefined":_typeof(d))?g.send(Object.keys(d).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(d[a])}).join("&")):g.send(d)})},a.get=function(b,c,d){return c&&"object"===("undefined"==typeof c?"undefined":_typeof(c))?a.http("GET",b+(b.indexOf("?")>0?"&":"?")+Object.keys(c).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(c[a])}).join("&"),void 0,d):c?a.http("GET",b+(b.indexOf("?")>0?"&":"?")+c,void 0,d):a.http("GET",b,c,d)},a.post=function(b,c,d){return a.http("POST",b,c,d)},a.patch=function(b,c,d){return a.http("PATCH",b,c,d)},a.del=function(b,c,d){return a.http("REMOVE",b,c,d)}}(Http);var Login={};!function(a){ready.push(function(){Nav.events.login_show=function(){null!==Http.getUser()?(Nav.goTab("logout-form"),_("#username").innerText=Http.getUser()):Nav.goTab("login-form")}}),_("#login-submit").onclick=function(){var a=_("#login-username"),b=_("#login-password");Http.setCredentials(a.value,b.value),Nav.success(t("logged_in_as",a.value)),a.value="",b.value="",Nav.events.login_show()},_("#logout-submit").onclick=function(){Http.deleteCredentials(),Nav.events.login_show()}}(Login);var Maps={};!function(a){ready.push(function(){Nav.events.map_show=function(){if(window.google){var b=a.map.getCenter();google.maps.event.trigger(a.map,"resize"),a.map.setCenter(b)}},window.mapScripts=!0,window.mapLoaded&&a.initMapInternal()});var b=Date.now;a.panToPosition=!location.hash.startsWith("#map/"),a.filter=["spot","event","group"];var c=void 0;a.icons={},a.shapes={},a.setGpsObj=function(b){c&&c.setMap(null),c=new google.maps.Circle({strokeColor:"#0000FF",strokeOpacity:.4,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.1,map:a.map,center:{lat:b.coords.latitude,lng:b.coords.longitude},radius:b.coords.accuracy,position:b})},a.updateGpsObj=function(b){return(!c||c.position.coords.accuracy>b.coords.accuracy||c.position.timestamp<b.timestamp-3e3)&&(a.setGpsObj(b),!0)},a.pan=function(b){var c=function(){a.map.panTo({lat:b.coords.latitude,lng:b.coords.longitude}),a.map.setZoom(b.coords.accuracy<200?17:b.coords.accuracy<500?16:b.coords.accuracy<2e3?15:13)};c(),google.maps.event.addListenerOnce(a.map,"idle",c)},a.track=function(c){"yes"===c&&(window.panToPosition=!0,Nav.goTab("map",0));var d=function(d){a.updateGpsObj(d)&&(c||Date.now()<b+1e4)&&("yes"===c||!location.hash.startsWith("#map")&&window.panToPosition)&&a.pan(d)};navigator.geolocation.getCurrentPosition(d,function(){return!1},{timeout:250}),navigator.geolocation.getCurrentPosition(d,function(){return!1},{enableHighAccuracy:!0})},a.markers={},a.load=function(b,c){var d=new google.maps.Marker({id:b.id,map:a.map,title:""+b.title,position:{lat:b.lat,lng:b.lng},data:b,icon:b.type.startsWith("multi")?a.icons.zoom:b.type.includes("group")?a.icons.group:b.type.includes("event")?a.icons.event:a.icons.spot,shape:b.type.startsWith("multi")?a.shapes.zoom:a.shapes.spot});c.push(d),google.maps.event.addListener(d,"click",a.show)},a.show=function(b){if((!b||b.latLng||b.pixel)&&(b=this),"add"===b.data.category){if(Nav.isLite)return;a.map.panTo(b.getPosition()),a.infoWindow.setContent('\n            <button type="button" onclick="Form.add(\'spot\')">&#x2795; '+t("spot")+'</button>\n            <button type="button" onclick="Form.add(\'event\')">&#x2795; '+t("event")+'</button>\n            <button type="button" onclick="Form.add(\'group\')">&#x2795; '+t("group")+"</button>"),a.infoWindow.open(a.map,b)}else if(b.data.category.startsWith("multi"))a.infoWindow.close(),a.map.panTo(b.getPosition()),a.map.setZoom(a.map.getZoom()+2);else{var c=b.data.type.startsWith("multi")?a.icons.zoom:b.data.type.includes("group")?a.icons.group:b.data.type.includes("event")?a.icons.event:a.icons.spot;a.infoWindow.setContent("<a onclick=\"Nav.navigate('#spot/"+b.data.id+'\');"><img class="type" src="'+c.url+'">'+b.data.title+"</a>"),a.infoWindow.setPosition(b.getPosition()),a.infoWindow.open(a.map),Proximity.getCloseNodes(b.data.lat,b.data.lng)}},a.loadAll=function(b){for(var c in b)if(!a.markers[c]||b[c]&&a.markers[c].length!==b[c].length){var d=[];for(var e in b[c])a.matchesFilter(b[c][e])&&a.load(b[c][e],d);if(a.markers[c])for(var f in a.markers[c])a.markers[c][f].setMap(null);a.markers[c]=d}for(var g in a.markers)if(!b[g]){for(var h in a.markers[g])a.markers[g][h].setMap(null);delete a.markers[g]}},a.handleBoundsChanged=function(){var b=a.map.getBounds();Geotile.loadBounds(b,a.loadAll);var c=a.map.getCenter(),d="#map/"+c.lat()+"/"+c.lng()+"/"+a.map.getZoom();location.hash===d||!location.hash.startsWith("#map/")&&""!==location.hash||history.replaceState({},"","#map/"+c.lat().toFixed(5)+"/"+c.lng().toFixed(5)+"/"+a.map.getZoom())},a.initMapInternal=function(){var b=location.hash,c=new google.maps.LatLngBounds({lat:49,lng:6},{lat:55,lng:15}),d={center:{lat:51.5167,lng:9.9167},zoom:7};if(a.map=new google.maps.Map(_("#map"),d),a.geocoder=new google.maps.Geocoder,b.startsWith("#map/")){var e=/#(\w+)\/([^\/]*)\/([^\/]*)(?:\/([^\/]*))?/g.exec(b);a.map.setCenter({lat:parseFloat(e[2]),lng:parseFloat(e[3])}),e[4]&&a.map.setZoom(parseInt(e[4],10))}else window.panToPosition?a.map.fitBounds(c):(a.map.setZoom(15),"undefined"!=typeof Spot.spot.lat&&a.map.setCenter(Spot.spot));google.maps.event.addDomListener(window,"resize",function(){var b=a.map.getCenter();google.maps.event.trigger(a.map,"resize"),a.map.setCenter(b)}),google.maps.event.addListener(a.map,"bounds_changed",a.handleBoundsChanged),google.maps.event.addListener(a.map,"click",a.newMarker);var f=document.createElement("div");a.createFilter(f),f.index=1,a.map.controls[google.maps.ControlPosition.LEFT_TOP].push(f),a.icons.event={url:"images/green.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},a.icons.group={url:"images/purple.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},a.icons.spot={url:"images/logo32.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},a.shapes.spot={coords:[15,0,31,7,15,31,0,7,15,0],type:"poly"},a.icons.zoom={url:"images/multi.png",size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,8)},a.shapes.zoom={coords:[11,0,14,1,16,3,18,5,18,13,18,15,24,20,24,23,15,19,7,18,1,15,0,7,3,2,7,0,11,0],type:"poly"},a.icons.crosshair={url:"images/crosshair.png",size:new google.maps.Size(49,49),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(24,24)},a.infoWindow=new google.maps.InfoWindow({content:"Some address here..",maxWidth:500,pixelOffset:new google.maps.Size(0,-31)}),a.track(!0),Form.restore()},a.geocode=function(b){a.geocoder.geocode({address:b},function(b,c){c===google.maps.GeocoderStatus.OK?(a.newMarker({latLng:b[0].geometry.location},!0),a.map.setCenter(b[0].geometry.location),a.map.setZoom(15)):Nav.error(t("error_geocode")+" "+c)})},a.newMarker=function(b,c){if(b.latLng||(b.latLng={lat:b.lat,lng:b.lng}),c||!Nav.isLite){if(!c&&a.map.getZoom()<14)return void Nav.success(t("zoom"));a.marker?a.marker.setPosition(b.latLng):(a.marker=new google.maps.Marker({position:b.latLng,map:a.map,title:t("new_marker"),icon:a.icons.crosshair,draggable:!Nav.isLite,data:{category:"add"}}),a.marker.addListener("drag",a.dragMarker),a.marker.addListener("dragend",a.endMarker),a.marker.addListener("click",a.show),a.show(a.marker)),a.dragMarker(),Form.backup()}},a.dragMarker=function(b){return Nav.success(t("position")+": "+a.marker.getPosition().lat().toFixed(5)+" "+a.marker.getPosition().lng().toFixed(5))},a.endMarker=function(b){a.map.panTo(a.marker.getPosition()),Form.backup()},a.clickMarker=function(b){return a.show(a.marker)},a.createFilter=function(a){a.className="filterDiv";var b=document.createElement("div");b.className="filterBtn",b.innerHTML="&#9881;",a.appendChild(b);var c=document.createElement("div");c.className="filterBox vanish",a.appendChild(c),c.innerHTML='Zeige:<br />\n            <span class="yes" id="filter-spot" onclick="Maps.toggleFilter(\'spot\')">'+t("spot")+'</span><br />\n            <span class="yes" id="filter-event" onclick="Maps.toggleFilter(\'event\')">'+t("event")+'</span><br />\n            <span class="yes" id="filter-group" onclick="Maps.toggleFilter(\'group\')">'+t("group")+"</span>",b.addEventListener("click",function(){var a=_(".filterBox")[0];a.className="filterBox"===a.className?"filterBox vanish":"filterBox"})},a.toggleFilter=function(b){var c=_("#filter-"+b);if(c.className="yes"===c.className?"no":"yes","yes"===c.className)a.filter.includes(b)||a.filter.push(b);else{var d=a.filter.indexOf(b);d!==-1&&a.filter.splice(d,1)}a.loadAll([]),a.handleBoundsChanged()},a.matchesFilter=function(b){var c=!0,d=!1,e=void 0;try{for(var f,g=a.filter[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;if(b.type.indexOf(h)!==-1)return!0}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return!1}}(Maps);var Nav={};!function(a){a.events={},a.isLite=!1,a.openTab=function(b,c){for(var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_("#"+b).parentNode,e=_("section"),f=void 0,g=0;g<e.length;g++)e[g].parentNode===d&&("block"===e[g].style.display&&(f=e[g].id,console.log("Hiding  "+e[g].id),a.events[e[g].id+"_hide"]&&a.events[e[g].id+"_hide"](b===e[g].id)),e[g].style.display="none");if(c){for(var h=_("button"),i=0;i<h.length;i++)h[i].className=h[i].className.replace(" active","");c.currentTarget.className+=" active"}_("#"+b).style.display="block",console.log("Showing "+b),a.events[b+"_show"]&&a.events[b+"_show"](f)},a.goTab=function(b,c){return a.openTab(b,void 0!==c?{currentTarget:_("button")[c]}:void 0)},a.resetTab=function(){return a.navigate("")},a.notice=function(b,c){window.noticeHideTimeout&&a.noticeHide(),_("#notice").className=c+" show",_("#notice-text").innerText=b,window.noticeHideTimeout=window.setTimeout(a.noticeHide,4e3)},a.error=function(b){return a.notice(b,"error")},a.success=function(b){return a.notice(b,"success")},a.noticeHide=function(a){_("#notice").className+=a?" vanish":" hide",window.noticeHideTimeout&&(window.clearTimeout(window.noticeHideTimeout),delete window.noticeHideTimeout)},a.navigate=function(b){if("string"==typeof b)return void(location.hash=b);if(b=location.hash,b.startsWith("#event/")||b.startsWith("#group/")||b.startsWith("#move/")||b.startsWith("#page/")||b.startsWith("#post/")||b.startsWith("#spot/")){var c=/#(\w+)\/(\d+)(?:\/(.*))?/g.exec(b);"lite"===c[3]&&(_("body")[0].className="lite",a.isLite=!0),Spot.loadSpot(c[2])}else if(b.startsWith("#login"))a.goTab("login",2);else if(b.startsWith("#search"))a.goTab("search",1),b.startsWith("#search/")&&(_("#search-text").value=/#(\w+)\/(.*)/g.exec(b)[2],Search.loadSearch());else if((""===b||b.startsWith("#map/"))&&(a.goTab("map",0),b.startsWith("#map/"))){var d=/#(\w+)\/([^\/]*)\/([^\/]*)(?:\/([^\/]*))?/g.exec(b);Map.map&&(Map.map.panTo({lat:parseFloat(d[2]),lng:parseFloat(d[3])}),d[4]&&Map.map.setZoom(parseInt(d[4],10)))}},a.goTab("map",0),_("body")[0].onkeyup=function(b){return 27!==b.which||a.goTab("map",0)},ready.push(function(){return function(){document.addEventListener("DOMContentLoaded",a.navigate,!1),window.onhashchange=a.navigate}})}(Nav);var Proximity={};!function(a){a.getCloseNodes=function(a,b){var c={lat:[a-1e-4,a+1e-4],lng:[b-1e-4,b+1e-4]};Geotile.loadBounds(c,function(a){var b=[],d={spot:0,event:1,group:2};for(var e in a)for(var f in a[e]){var g=a[e][f];g.lat>c.lat[0]&&g.lat<c.lat[1]&&g.lng>c.lng[0]&&g.lng<c.lng[1]&&b.push(g)}var h="";b.sort(function(a,b){return d[a.type]-d[b.type]});for(var i in b){var j=b[i];h+='<a class="entry" onclick="Nav.navigate(\'#spot/'+j.id+'\');"><img class="type" src="'+Maps.icons[j.type].url+'">'+j.title+"</a>"}""!==h&&Maps.infoWindow.setContent(h)})}}(Proximity);var Search={};!function(a){var b={};_("#search-submit").onclick=function(){var a=_("#search-text").value;Nav.navigate((/^(0|[1-9]\d*)$/.test(a)?"#spot/":"#search/")+a)},_("#search-geocode").onclick=function(){var a=_("#search-text").value;Maps.geocode(a),Nav.navigate("")},a.loadSearch=function(){var c=_("#search-text").value;/^(0|[1-9]\d*)$/.test(c)?Nav.navigate("#spot/"+c):(b.data={_format:"hal_json",status:"All",type:"All",title:c,langcode:"All",page:0},Http.get("//www.parkour.org/rest/content/node?status=All&type=All&title=&langcode=All&page=0",b.data,{Authorization:!1}).then(a.showPage))},a.showPage=function(a){var b='<div class="grid">';0===a.length&&(b+=t("no_results_found"));var c=!0,d=!1,e=void 0;try{for(var f,g=a[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value,i=void 0,j=!0,k=!1,l=void 0;try{for(var m,n=Spot.find("nid|\\d+|value",h)[Symbol.iterator]();!(j=(m=n.next()).done);j=!0){var o=m.value;i=o}}catch(a){k=!0,l=a}finally{try{!j&&n.return&&n.return()}finally{if(k)throw l}}b+="<article onclick=\"Nav.navigate('#spot/"+i+"');\">";var p=!0,q=!1,r=void 0;try{for(var s,u=Spot.find("_links|.+parkour.org/rest/relation/node/.+/field_images|\\d+|href",h)[Symbol.iterator]();!(p=(s=u.next()).done);p=!0){var v=s.value;if(b+='<div class="in-place cover" style="background-image: url('+Spot.getUrl(v)+');"></div>',v)break}}catch(a){q=!0,r=a}finally{try{!p&&u.return&&u.return()}finally{if(q)throw r}}b+='<div class="in-place title">',_("#spot-title").innerText=t("no_title");var w=!0,x=!1,y=void 0;try{for(var z,A=Spot.find("title|\\d+|value",h)[Symbol.iterator]();!(w=(z=A.next()).done);w=!0){var B=z.value;b+="<h1><span>"+strip(B)+"</span></h1>"}}catch(a){x=!0,y=a}finally{try{!w&&A.return&&A.return()}finally{if(x)throw y}}var C=!0,D=!1,E=void 0;try{for(var F,G=Spot.find("body|\\d+|value",h)[Symbol.iterator]();!(C=(F=G.next()).done);C=!0){var H=F.value;b+="<p><span>"+strip(H).substring(0,100)+"</span></p>"}}catch(a){D=!0,E=a}finally{try{!C&&G.return&&G.return()}finally{if(D)throw E}}b+="</div>",b+="</article>"}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}b+="</div>",_("#search-page").innerHTML=b}}(Search);var Spot={};!function(a){a.spot={},ready.push(function(){return Nav.events.spot_hide=function(){return _("#map").className=""}}),a.loadSpot=function(b){Http.get("//www.parkour.org/"+l+"/rest/node/"+b,{_format:"hal_json"},{Authorization:!1}).then(function(c){a.spot={id:b},_("#spot-type").innerText="";var d=!0,e=!1,f=void 0;try{for(var g,h=a.find("\\d+|type|\\d+|target_id",c)[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;_("#spot").className="spot-type-"+i,_("#spot-type").innerText=t("type_"+i)}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}var j=!0,k=!1,l=void 0;try{for(var m,n=a.find("\\d+|field_spot_type|\\d+|value",c)[Symbol.iterator]();!(j=(m=n.next()).done);j=!0){var o=m.value;_("#spot-type").innerText=t("spot_type_"+o)}}catch(a){k=!0,l=a}finally{try{!j&&n.return&&n.return()}finally{if(k)throw l}}var p=!0,q=!1,r=void 0;try{for(var s,u=a.find("\\d+|field_category|\\d+|value",c)[Symbol.iterator]();!(p=(s=u.next()).done);p=!0){var v=s.value;_("#spot-type").innerText=t("move_type_"+v)}}catch(a){q=!0,r=a}finally{try{!p&&u.return&&u.return()}finally{if(q)throw r}}var w=!0,x=!1,y=void 0;try{for(var z,A=a.find("\\d+|field_move_category|\\d+|value",c)[Symbol.iterator]();!(w=(z=A.next()).done);w=!0){var B=z.value;_("#spot-type").innerText=t("move_type_"+B)}}catch(a){x=!0,y=a}finally{try{!w&&A.return&&A.return()}finally{if(x)throw y}}var C=!0,D=!1,E=void 0;try{for(var F,G=a.find("\\d+|field_level|\\d+|value",c)[Symbol.iterator]();!(C=(F=G.next()).done);C=!0){var H=F.value;_("#spot-type").innerText+=" ("+t("move_type_"+H)+")"}}catch(a){D=!0,E=a}finally{try{!C&&G.return&&G.return()}finally{if(D)throw E}}var I=!0,J=!1,K=void 0;try{for(var L,M=a.find("\\d+|field_group_type|\\d+|value",c)[Symbol.iterator]();!(I=(L=M.next()).done);I=!0){var N=L.value;_("#spot-type").innerText=t("group_type_"+N)}}catch(a){J=!0,K=a}finally{try{!I&&M.return&&M.return()}finally{if(J)throw K}}var O=!0,P=!1,Q=void 0;try{for(var R,S=a.find("\\d+|field_event_type|\\d+|value",c)[Symbol.iterator]();!(O=(R=S.next()).done);O=!0){var T=R.value;_("#spot-type").innerText=t("event_type_"+T)}}catch(a){P=!0,Q=a}finally{try{!O&&S.return&&S.return()}finally{if(P)throw Q}}_("#spot-title").innerText=t("no_title");var U=!0,V=!1,W=void 0;try{for(var X,Y=a.find("\\d+|title|\\d+|value",c)[Symbol.iterator]();!(U=(X=Y.next()).done);U=!0){var Z=X.value;_("#spot-title").innerText=Z}}catch(a){V=!0,W=a}finally{try{!U&&Y.return&&Y.return()}finally{if(V)throw W}}_("#spot-body").innerText=t("no_body");var $=!0,aa=!1,ba=void 0;try{for(var ca,da=a.find("\\d+|body|\\d+|value",c)[Symbol.iterator]();!($=(ca=da.next()).done);$=!0){var ea=ca.value;_("#spot-body").innerHTML=ea}}catch(a){aa=!0,ba=a}finally{try{!$&&da.return&&da.return()}finally{if(aa)throw ba}}var fa="",ga=!0,ha=!1,ia=void 0;try{for(var ja,ka=a.find("\\d+|_links|.+parkour.org/rest/relation/node/.+/field_images|\\d+|href",c)[Symbol.iterator]();!(ga=(ja=ka.next()).done);ga=!0){var la=ja.value;fa+='<img src="'+a.getUrl(la)+'" />'}}catch(a){ha=!0,ia=a}finally{try{!ga&&ka.return&&ka.return()}finally{if(ha)throw ia}}_("#spot-images").innerHTML=fa||t("no_images");var ma=!0,na=!1,oa=void 0;try{for(var pa,qa=a.find("\\d+|field_location|\\d+|lat",c)[Symbol.iterator]();!(ma=(pa=qa.next()).done);ma=!0){var ra=pa.value;a.spot.lat=ra,_("#spot-lat").innerHTML=ra}}catch(a){na=!0,oa=a}finally{try{!ma&&qa.return&&qa.return()}finally{if(na)throw oa}}var sa=!0,ta=!1,ua=void 0;try{for(var va,wa=a.find("\\d+|field_location|\\d+|lon",c)[Symbol.iterator]();!(sa=(va=wa.next()).done);sa=!0){var xa=va.value;a.spot.lng=xa,_("#spot-lng").innerHTML=xa}}catch(a){ta=!0,ua=a}finally{try{!sa&&wa.return&&wa.return()}finally{if(ta)throw ua}}Nav.goTab("spot"),a.spot.lat&&a.spot.lng?(_("#spot-geo").style.display="block",_("#spot-map").style.display="inline",_("#spot-maps-form").style.display="inline",_(".add-here").forEach(function(a){return a.style.display="inline-block"}),_("#spot-maps-formdata").value=a.spot.lat+","+a.spot.lng,_("#map").style.display="block",_("#map").className="half",Maps.panToPosition=!1,google.maps.event.addListenerOnce(Maps.map,"idle",function(){google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(a.spot),Maps.map.setZoom(15)}),console.log(a.spot),Nav.isLite&&Maps.newMarker(a.spot,!0),google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(a.spot),Maps.map.setZoom(15)):(_("#spot-geo").style.display="none",_("#spot-map").style.display="none",_("#spot-maps-form").style.display="none",_(".add-here").forEach(function(a){return a.style.display="none"}))},function(a){return Nav.error(t("error_load_spot"))})},a.getUrl=function(a){return a.replace("/sites/default/files/20","/sites/default/files/styles/grid/public/20")},a.find=function(a,b){var c=[b];a=a.split("|");var d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=new RegExp("^"+i+"$"),k=[],l=!0,m=!1,n=void 0;try{for(var o,p=c[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){var q=o.value;for(var r in q)q.hasOwnProperty(r)&&j.test(r)&&k.push(q[r])}}catch(a){m=!0,n=a}finally{try{!l&&p.return&&p.return()}finally{if(m)throw n}}c=k}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c},_("#spot-map").onclick=function(){Nav.navigate(""),Maps.map.setCenter(a.spot),Maps.map.setZoom(15)},_("#spot-web").onclick=function(){location.href="//www.parkour.org/"+l+"/node/"+a.spot.id}}(Spot),function(){window.runLater(),window.addEventListener("load",function(){return setTimeout(function(){return window.scrollTo(0,1)},0)})}();