/*! spotmap - v0.2.4 - 2018-05-06
* https://github.com/windowsfreak/spotmap
* Copyright (c) 2018 Bj√∂rn Eberhardt; Licensed MIT */

"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(i){i.ready=[],i.runLater=function(){return(i.ready=i.ready.map(function(e){return"function"==typeof e&&e()}).filter(function(e){return e})).length&&i.runLater()},i._=function(e){return"#"===e[0]?document.getElementById(e.slice(1)):document.querySelectorAll(e)},i.dom=function(e){return document.createElement(e)},i.strip=function(e){var t=i.dom("DIV");return t.innerHTML=e,t.textContent||t.innerText||""},i.html=function(e){var t=i.dom("DIV");return t.innerText=e,t.innerHTML||""},i.t=function(e,t){return lang[e]||console.log("MISSING: "+e),lang[e]?lang[e].replace("\\1",t):"MISSING: "+e},i.setLang=function(e){localStorage.setItem("lang",e),location.reload()},i.t_html=function(){var e=!0,t=!1,o=void 0;try{for(var a,n=i._("*")[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var r=a.value;r.getAttribute("data-translate")&&(r[0<=["input","textarea","select"].indexOf(r.tagName.toLowerCase())?"placeholder":"innerHTML"]=i.t(r.getAttribute("data-translate")))}}catch(e){t=!0,o=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw o}}},i.script=function(e,t){var o=i.dom("script");o.type="text/javascript",o.async=!0,o.src=e;var a=i._("head")[0];t&&o.addEventListener("load",t,!1),a.appendChild(o)},i.t_html()}(window);var Form={};!function(a){var e=!1,n={spot:["gym","parkourpark","parkourgym","climbinggym","pool","cliff"],event:["training","workshop","jam","trip","competition"],group:["private","community","club","company"],move:["moves","conditioning","games","jumps","vaults","bar","flips","combinations","freezes","beginner","intermediate","advanced"]};window.captcha=function(){grecaptcha.render("form-captcha",{sitekey:"6LdRg1cUAAAAAFjzUokSQB6egcNS_o9EF_KAmW7i",callback:a.save})},ready.push(function(){Nav.events.form_show=function(){e||(script("https://www.google.com/recaptcha/api.js?onload=captcha&render=explicit"),e=!0),_("#map").style.display="block",_("#map").className="half",Maps.map.setCenter(Maps.marker.getPosition()),google.maps.event.trigger(Maps.map,"resize"),google.maps.event.addListenerOnce(Maps.map,"idle",function(){google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(Maps.marker.getPosition())}),Http.getUser()||(Nav.success(t("error_login_required")),Nav.navigate("#login"))},Nav.events.form_hide=function(e){_("#map").className="",localStorage.getItem("form_text")&&!e&&Nav.success(t("draft_saved"))}}),a.add_here=function(e){Maps.newMarker(Spot.spot,!0),a.add(e)},a.add=function(o){var e={spot:t("new_spot"),group:t("new_group"),event:t("new_event")};_("#form-type").innerText=e[o],_("#form-category").innerHTML='<option value="" disabled selected hidden>'+t("form_category")+"</option>"+n[o].map(function(e){return'<option value="'+e+'">'+t(o+"_type_"+e)+"</option>"}).join(""),_("#form-category").value="",Spot.marker={lat:Maps.marker.getPosition().lat(),lng:Maps.marker.getPosition().lng(),type:o},Nav.goTab("form")},a.backup=function(){localStorage.setItem("form_title",_("#form-title").value),localStorage.setItem("form_text",_("#form-text").value),Maps.marker&&(localStorage.setItem("form_lat",Maps.marker.getPosition().lat()),localStorage.setItem("form_lng",Maps.marker.getPosition().lng())),Spot.marker&&localStorage.setItem("form_type",Spot.marker.type)},a.restore=function(){localStorage.getItem("form_text")&&(_("#form-title").value=localStorage.getItem("form_title"),_("#form-text").value=localStorage.getItem("form_text"),Spot.marker={lat:parseFloat(localStorage.getItem("form_lat")),lng:parseFloat(localStorage.getItem("form_lng")),type:localStorage.getItem("form_type")},window.panToPosition=!1,Maps.newMarker(Spot.marker,!0),Maps.map.panTo(Spot.marker),a.add(Spot.marker.type),google.maps.event.addListenerOnce(Maps.map,"idle",function(){Maps.map.panTo(Maps.marker.getPosition())}),Nav.success(t("draft_restored")))},a.remove=function(e){(e||confirm(t("draft_delete_confirm")))&&(localStorage.removeItem("form_title"),localStorage.removeItem("form_text"),localStorage.removeItem("form_lat"),localStorage.removeItem("form_lng"),localStorage.removeItem("form_type"),_("#form-title").value="",_("#form-text").value="",Nav.goTab("map",0),e||Nav.success(t("draft_deleted")))},a.save=function(){if(_("#form-category").value){var e=grecaptcha.getResponse();e?(!function(e){Nav.success(t("in_progress"));var o=Http.getUser();Http.post("//map.parkour.org/api/v1/spot",JSON.stringify({type:Spot.marker.type,category:_("#form-category").value,title:_("#form-title").value,description:html(_("#form-text").value),lat:Spot.marker.lat,lng:Spot.marker.lng,user_created:o}),{"Content-Type":"application/json","X-CSRF-Token":e,"X-Username":o}).then(function(e){Nav.success(t("node_added")),Nav.navigate("#spot/"+e.id),a.remove(!0)},function(e){return Nav.error(t(403===e.status||401===e.status?"error_forbidden":"error_add_node")+" "+e.message)})}(e),grecaptcha.reset()):grecaptcha.execute()}else Nav.error(t("form_category"))}}(Form);var Geohash={};!function(c){c.BITS=[16,8,4,2,1],c.BASE32="0123456789bcdefghjkmnpqrstuvwxyz",c.NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}},c.BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}},c.NEIGHBORS.bottom.odd=c.NEIGHBORS.left.even,c.NEIGHBORS.top.odd=c.NEIGHBORS.right.even,c.NEIGHBORS.left.odd=c.NEIGHBORS.bottom.even,c.NEIGHBORS.right.odd=c.NEIGHBORS.top.even,c.BORDERS.bottom.odd=c.BORDERS.left.even,c.BORDERS.top.odd=c.BORDERS.right.even,c.BORDERS.left.odd=c.BORDERS.bottom.even,c.BORDERS.right.odd=c.BORDERS.top.even,c.refineInterval=function(e,t,o){return e[t&o?0:1]=(e[0]+e[1])/2},c.adjacent=function(e,t){var o=(e=e.toLowerCase()).charAt(e.length-1),a=e.length%2?"odd":"even",n=e.substring(0,e.length-1);return(-1!==c.BORDERS[t][a].indexOf(o)?c.adjacent(n,t):n)+c.BASE32[c.NEIGHBORS[t][a].indexOf(o)]},c.decode=function(e){var t=1,o=[],a=[];o[0]=-90,o[1]=90,a[0]=-180;a[1]=180;for(var n=0;n<e.length;n++)for(var r=e[n],i=c.BASE32.indexOf(r),s=0;s<5;s++){var l=c.BITS[s];t?(2,c.refineInterval(a,i,l)):(2,c.refineInterval(o,i,l)),t=!t}return o[2]=(o[0]+o[1])/2,a[2]=(a[0]+a[1])/2,{lat:o,lng:a}},c.encode=function(e,t){var o=1,a=[],n=[],r=0,i=0,s="";for(a[0]=-90,a[1]=90,n[0]=-180,n[1]=180;s.length<12;){if(o){var l=(n[0]+n[1])/2;l<t?(i|=c.BITS[r],n[0]=l):n[1]=l}else{var p=(a[0]+a[1])/2;p<e?(i|=c.BITS[r],a[0]=p):a[1]=p}o=!o,r<4?r++:(s+=c.BASE32[i],i=r=0)}return s}}(Geohash);var Geotile={};!function(b){var k={},S=[[180,360],[45,45],[5.625,11.25],[1.40625,1.40625],[.17578125,.3515625],[.0439453125,.0439453125],[.0054931640625,.010986328125],[.001373291015625,.001373291015625],[.000171661376953125,.00034332275390625],[4291534423828125e-20,4291534423828125e-20],[5364418029785156e-21,10728836059570312e-21],[1341104507446289e-21,1341104507446289e-21],[1.6763806343078613e-7,3.3527612686157227e-7]];b.onlyUnique=function(e,t,o){return o.indexOf(e)===t},b.extend=function(e,t){var o=e.slice(0),a=!0,n=!1,r=void 0;try{for(var i,s=o[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value;e.push(Geohash.adjacent(l,t))}}catch(e){n=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw r}}return e.filter(b.onlyUnique)},b.filter=function(e,t){var o={};for(var a in e)if(e.hasOwnProperty(a)){var n=t(a,e[a]);void 0!==n&&(o[a]=n)}return o},b.loadBounds=function(e,o){var a=void 0,n={lat:(a=e.lat?e:{lat:[(a={sw:e.getSouthWest(),ne:e.getNorthEast()}).sw.lat(),a.ne.lat()],lng:[a.sw.lng(),a.ne.lng()]}).lat.slice(0),lng:a.lng.slice(0)};n.lng[1]<n.lng[0]&&(n.lng[1]+=360),360<n.lng[0]+n.lng[1]&&(n.lng[1]-=360,n.lng[0]-=360);var r=[n.lat[1]-n.lat[0],n.lng[1]-n.lng[0]],i=void 0,s=Math.min(r[0],r[1]);(5<(i=23<s?0:2.8<s?1:.7<s?2:.087<s?3:.022<s?4:.0027<s?5:6)||i<0)&&(i=-1);for(var l=12;0<l--&&!(S[l][0]>r[0]/3&&S[l][1]>r[1]/3););l++;for(var p=void 0;0<l;){var c=S[--l],d=Geohash.encode((n.lat[0]+n.lat[1])/2,(n.lng[0]+n.lng[1])/2).substring(0,l);p=[d];var g=Geohash.decode(d);if(g.lat[0]>a.lat[0]){if(g.lat[0]-c[0]>a.lat[0])continue;p=b.extend(p,"bottom")}if(g.lat[1]<a.lat[1]){if(g.lat[1]+c[0]<a.lat[1])continue;p=b.extend(p,"top")}if(g.lng[0]>a.lng[0]){if(g.lng[0]-c[1]>a.lng[0])continue;p=b.extend(p,"left")}if(g.lng[1]<a.lng[1]){if(g.lng[1]+c[1]<a.lng[1])continue;p=b.extend(p,"right")}break}k[i]||(k[i]={});var u={},m=!0,f=!1,v=void 0;try{for(var h,y=p[Symbol.iterator]();!(m=(h=y.next()).done);m=!0){var _=h.value;u[_]=k[i][_]}}catch(e){f=!0,v=e}finally{try{!m&&y.return&&y.return()}finally{if(f)throw v}}var w=Object.keys(b.filter(u,function(e,t){return void 0===t?e:void 0})).map(function(e){return e});return w.length&&Http.get("//map.parkour.org/query5j.php",{tiles:w.join(","),zoom:i},{Authorization:!1}).then(function(e){Object.assign(k[i],e),Object.assign(u,e),o(u)},function(){return Nav.error(t("error_load_spotmap"))}),o(u),u}}(Geotile);var Help={};!function(o){ready.push(function(){return Nav.events.help_show=function(e){return o.previous="help"!==e?e:o.previous}}),o.show=function(e){Http.get("./static/"+e+"_"+l+".json",void 0,{Authorization:!1}).then(function(e){_("#help-title").innerText=t("no_title");var o=!0,a=!1,n=void 0;try{for(var r,i=Spot.find("title",e)[Symbol.iterator]();!(o=(r=i.next()).done);o=!0){var s=r.value;_("#help-title").innerText=s}}catch(e){a=!0,n=e}finally{try{!o&&i.return&&i.return()}finally{if(a)throw n}}_("#help-body").innerText=t("no_body");var l=!0,p=!1,c=void 0;try{for(var d,g=Spot.find("body",e)[Symbol.iterator]();!(l=(d=g.next()).done);l=!0){var u=d.value;_("#help-body").innerHTML=u}}catch(e){p=!0,c=e}finally{try{!l&&g.return&&g.return()}finally{if(p)throw c}}Nav.goTab("help")},function(e){return Nav.error(t("no_results_found"))})}}(Help);var Http={};!function(a){a.b64a=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},a.getUser=function(){return localStorage.getItem("d8_user")},a.getCredentials=function(){return localStorage.getItem("d8_auth")||"Basic Og=="},a.setCredentials=function(e,t){localStorage.setItem("d8_user",e)},a.deleteCredentials=function(){localStorage.removeItem("d8_user")},a.http=function(r,i,s){var l=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return!1===l.Authorization?delete l.Authorization:l.user?(l.Authorization="Basic "+a.b64a(l.user+":"+l.pass),delete l.user,delete l.pass):i.match(/^(https?:)?\/\/(www\.)?map\.parkour\.org\/?/)&&(l.Authorization=a.getCredentials()),new Promise(function(o,a){var n=new XMLHttpRequest;n.open(r,i),n.onload=function(){if(200<=this.status&&this.status<300)try{o(JSON.parse(n.response))}catch(e){Nav.error(t("error_server_request")),o({method:r,url:i,params:s,headers:l,status:this.status,statusText:n.statusText,message:n.response})}else n.onerror()},n.onerror=function(){Nav.error(t("error_server_request"));var e={method:r,url:i,params:s,headers:l,status:this.status,statusText:n.statusText,message:n.response};a(e)},l&&Object.keys(l).forEach(function(e){return n.setRequestHeader(e,l[e])}),s&&"object"===(void 0===s?"undefined":_typeof(s))?n.send(Object.keys(s).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(s[e])}).join("&")):n.send(s)})},a.get=function(e,t,o){return t&&"object"===(void 0===t?"undefined":_typeof(t))?a.http("GET",e+(0<e.indexOf("?")?"&":"?")+Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),void 0,o):t?a.http("GET",e+(0<e.indexOf("?")?"&":"?")+t,void 0,o):a.http("GET",e,t,o)},a.post=function(e,t,o){return a.http("POST",e,t,o)},a.patch=function(e,t,o){return a.http("PATCH",e,t,o)},a.del=function(e,t,o){return a.http("REMOVE",e,t,o)}}(Http);var Login={};ready.push(function(){Nav.events.login_show=function(){null!==Http.getUser()?(Nav.goTab("logout-form"),_("#username").innerText=Http.getUser()):Nav.goTab("login-form")}}),_("#login-submit").onclick=function(){var e=_("#login-username");Http.setCredentials(e.value,""),Nav.success(t("logged_in_as",e.value)),e.value="",Nav.events.login_show()},_("#logout-submit").onclick=function(){Http.deleteCredentials(),Nav.events.login_show()};var Maps={};!function(s){ready.push(function(){Nav.events.map_show=function(){if(window.google){var e=s.map.getCenter();google.maps.event.trigger(s.map,"resize"),s.map.setCenter(e)}},window.mapScripts=!0,window.mapLoaded&&s.initMapInternal()});var o=Date.now;window.panToPosition=!location.hash.startsWith("#map/"),s.filter=["spot","event","group"];var a=void 0;s.icons={},s.shapes={},s.setGpsObj=function(e){a&&a.setMap(null),a=new google.maps.Circle({strokeColor:"#0000FF",strokeOpacity:.4,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.1,map:s.map,center:{lat:e.coords.latitude,lng:e.coords.longitude},radius:e.coords.accuracy,position:e,clickable:!1})},s.updateGpsObj=function(e){return(!a||a.position.coords.accuracy>e.coords.accuracy||a.position.timestamp<e.timestamp-3e3)&&(s.setGpsObj(e),!0)},s.pan=function(e){var t=function(){s.map.panTo({lat:e.coords.latitude,lng:e.coords.longitude}),s.map.setZoom(e.coords.accuracy<200?17:e.coords.accuracy<500?16:e.coords.accuracy<2e3?15:13)};t(),google.maps.event.addListenerOnce(s.map,"idle",t)},s.track=function(t){"yes"===t&&(window.panToPosition=!0,Nav.goTab("map",0));var e=function(e){console.log(e),s.updateGpsObj(e)&&(t||Date.now()<o+1e4)&&("yes"!==t&&location.hash.startsWith("#map")&&!window.panToPosition||s.pan(e))};try{navigator.geolocation.getCurrentPosition(e,function(){return!1},{timeout:250}),navigator.geolocation.getCurrentPosition(e,function(){return!1},{enableHighAccuracy:!0})}catch(e){Nav.error("The browser is too old, Geolocation is not supported.")}},s.markers={},s.load=function(e,t){var o=new google.maps.Marker({id:e.id,map:s.map,title:""+e.title,position:{lat:e.lat,lng:e.lng},data:e,icon:e.type.startsWith("multi")?s.icons.zoom:e.type.includes("group")?s.icons.group:e.type.includes("event")?s.icons.event:s.icons.spot,shape:e.type.startsWith("multi")?s.shapes.zoom:s.shapes.spot});t.push(o),google.maps.event.addListener(o,"click",s.show)},s.show=function(e){if((!e||e.latLng||e.pixel)&&(e=this),"add"===e.data.category){if(Nav.isLite)return;s.map.panTo(e.getPosition()),s.infoWindow.setContent('\n            <button type="button" onclick="Form.add(\'spot\')">&#x2795; '+t("spot")+'</button>\n            <button type="button" onclick="Form.add(\'event\')">&#x2795; '+t("event")+'</button>\n            <button type="button" onclick="Form.add(\'group\')">&#x2795; '+t("group")+"</button>"),s.infoWindow.open(s.map,e)}else if(e.data.category.startsWith("multi"))s.infoWindow.close(),s.map.panTo(e.getPosition()),s.map.setZoom(s.map.getZoom()+2);else{var o=e.data.type.startsWith("multi")?s.icons.zoom:e.data.type.includes("group")?s.icons.group:e.data.type.includes("event")?s.icons.event:s.icons.spot;s.infoWindow.setContent("<a onclick=\"Nav.navigate('#spot/"+e.data.id+'\');"><img class="type" src="'+o.url+'">'+e.data.title+"</a>"),s.infoWindow.setPosition(e.getPosition()),s.infoWindow.open(s.map),Proximity.getCloseNodes(e.data.lat,e.data.lng)}},s.loadAll=function(e){for(var t in e)if(!s.markers[t]||e[t]&&s.markers[t].length!==e[t].length){var o=[];for(var a in e[t])s.matchesFilter(e[t][a])&&s.load(e[t][a],o);if(s.markers[t])for(var n in s.markers[t])s.markers[t][n].setMap(null);s.markers[t]=o}for(var r in s.markers)if(!e[r]){for(var i in s.markers[r])s.markers[r][i].setMap(null);delete s.markers[r]}},s.handleBoundsChanged=function(){var e=s.map.getBounds();Geotile.loadBounds(e,s.loadAll);var t=s.map.getCenter(),o="#map/"+t.lat()+"/"+t.lng()+"/"+s.map.getZoom();location.hash===o||!location.hash.startsWith("#map/")&&""!==location.hash||history.replaceState({},"","#map/"+t.lat().toFixed(5)+"/"+t.lng().toFixed(5)+"/"+s.map.getZoom())},s.initMapInternal=function(){var e=location.hash,t=new google.maps.LatLngBounds({lat:49,lng:6},{lat:55,lng:15});if(s.map=new google.maps.Map(_("#map"),{center:{lat:51.5167,lng:9.9167},zoom:7}),s.geocoder=new google.maps.Geocoder,e.startsWith("#map/")){var o=/#(\w+)\/([^/]*)\/([^/]*)(?:\/([^/]*))?/g.exec(e);s.map.setCenter({lat:parseFloat(o[2]),lng:parseFloat(o[3])}),o[4]&&s.map.setZoom(parseInt(o[4],10))}else window.panToPosition?s.map.fitBounds(t):(s.map.setZoom(15),void 0!==Spot.spot.lat&&s.map.setCenter(Spot.spot));google.maps.event.addDomListener(window,"resize",function(){var e=s.map.getCenter();google.maps.event.trigger(s.map,"resize"),s.map.setCenter(e)}),google.maps.event.addListener(s.map,"bounds_changed",s.handleBoundsChanged),google.maps.event.addListener(s.map,"click",s.newMarker);var a=dom("div");s.createFilter(a),a.index=1,s.map.controls[google.maps.ControlPosition.LEFT_TOP].push(a),s.icons.event={url:"images/green.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},s.icons.group={url:"images/purple.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},s.icons.spot={url:"images/logo32.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},s.shapes.spot={coords:[15,0,31,7,15,31,0,7,15,0],type:"poly"},s.icons.zoom={url:"images/multi.png",size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,8)},s.shapes.zoom={coords:[11,0,14,1,16,3,18,5,18,13,18,15,24,20,24,23,15,19,7,18,1,15,0,7,3,2,7,0,11,0],type:"poly"},s.icons.crosshair={url:"images/crosshair.png",size:new google.maps.Size(49,49),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(24,24)},s.infoWindow=new google.maps.InfoWindow({content:"Some address here..",maxWidth:500,pixelOffset:new google.maps.Size(0,-31)}),s.track(!0),Form.restore()},s.geocode=function(e){s.geocoder.geocode({address:e},function(e,o){o===google.maps.GeocoderStatus.OK?(s.newMarker({latLng:e[0].geometry.location},!0),s.map.setCenter(e[0].geometry.location),s.map.setZoom(15)):Nav.error(t("error_geocode")+" "+o)})},s.newMarker=function(e,o){e.latLng||(e.latLng={lat:e.lat,lng:e.lng}),!o&&Nav.isLite||(!o&&s.map.getZoom()<14?Nav.success(t("zoom")):(s.marker?s.marker.setPosition(e.latLng):(s.marker=new google.maps.Marker({position:e.latLng,map:s.map,title:t("new_marker"),icon:s.icons.crosshair,draggable:!Nav.isLite,data:{category:"add"}}),s.marker.addListener("drag",s.dragMarker),s.marker.addListener("dragend",s.endMarker),s.marker.addListener("click",s.show),s.show(s.marker)),s.dragMarker(),Form.backup()))},s.dragMarker=function(e){return Nav.success(t("position")+": "+s.marker.getPosition().lat().toFixed(5)+" "+s.marker.getPosition().lng().toFixed(5))},s.endMarker=function(e){s.map.panTo(s.marker.getPosition()),Form.backup()},s.clickMarker=function(e){return s.show(s.marker)},s.createFilter=function(e){e.className="filterDiv";var o=dom("div");o.className="filterBtn",o.innerHTML="&#9881;",e.appendChild(o);var a=dom("div");a.className="filterBox vanish",e.appendChild(a),a.innerHTML='Zeige:<br />\n            <span class="yes" id="filter-spot" onclick="Maps.toggleFilter(\'spot\')">'+t("spot")+'</span><br />\n            <span class="yes" id="filter-event" onclick="Maps.toggleFilter(\'event\')">'+t("event")+'</span><br />\n            <span class="yes" id="filter-group" onclick="Maps.toggleFilter(\'group\')">'+t("group")+"</span>",o.addEventListener("click",function(){var e=_(".filterBox")[0];e.className="filterBox"===e.className?"filterBox vanish":"filterBox"})},s.toggleFilter=function(e){var t=_("#filter-"+e);if(t.className="yes"===t.className?"no":"yes","yes"===t.className)s.filter.includes(e)||s.filter.push(e);else{var o=s.filter.indexOf(e);-1!==o&&s.filter.splice(o,1)}s.loadAll([]),s.handleBoundsChanged()},s.matchesFilter=function(e){var t=!0,o=!1,a=void 0;try{for(var n,r=s.filter[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var i=n.value;if(-1!==e.type.indexOf(i))return!0}}catch(e){o=!0,a=e}finally{try{!t&&r.return&&r.return()}finally{if(o)throw a}}return!1}}(Maps);var Nav={};!function(l){l.events={},l.isLite=!1,l.openTab=function(e,t){for(var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:_("#"+e).parentNode,a=_("section"),n=void 0,r=0;r<a.length;r++)a[r].parentNode===o&&("block"===a[r].style.display&&(n=a[r].id,console.log("Hiding  "+a[r].id),l.events[a[r].id+"_hide"]&&l.events[a[r].id+"_hide"](e===a[r].id)),a[r].style.display="none");if(t){for(var i=_("button"),s=0;s<i.length;s++)i[s].className=i[s].className.replace(" active","");t.currentTarget.className+=" active"}_("#"+e).style.display="block",console.log("Showing "+e),l.events[e+"_show"]&&l.events[e+"_show"](n)},l.goTab=function(e,t){return l.openTab(e,void 0!==t?{currentTarget:_("button")[t]}:void 0)},l.resetTab=function(){return l.navigate("")},l.notice=function(e,t){window.noticeHideTimeout&&l.noticeHide(),_("#notice").className=t+" show",_("#notice-text").innerText=e,window.noticeHideTimeout=window.setTimeout(l.noticeHide,4e3)},l.error=function(e){return l.notice(e,"error")},l.success=function(e){return l.notice(e,"success")},l.noticeHide=function(e){_("#notice").className+=e?" vanish":" hide",window.noticeHideTimeout&&(window.clearTimeout(window.noticeHideTimeout),delete window.noticeHideTimeout)},l.navigate=function(e){if("string"!=typeof e){if((e=location.hash).startsWith("#event/")||e.startsWith("#group/")||e.startsWith("#move/")||e.startsWith("#page/")||e.startsWith("#post/")||e.startsWith("#spot/")){var t=/#(\w+)\/(\d+)(?:\/(.*))?/g.exec(e);"lite"===t[3]&&(_("body")[0].className="lite",l.isLite=!0),Spot.loadSpot(t[2])}else if(e.startsWith("#login"))l.goTab("login",2);else if(e.startsWith("#search"))l.goTab("search",1),e.startsWith("#search/")&&(_("#search-text").value=decodeURIComponent(/#(\w+)\/(.*)/g.exec(e)[2]),Search.loadSearch());else if((""===e||e.startsWith("#map/"))&&(l.goTab("map",0),e.startsWith("#map/"))){var o=/#(\w+)\/([^/]*)\/([^/]*)(?:\/([^/]*))?/g.exec(e);Map.map&&(Map.map.panTo({lat:parseFloat(o[2]),lng:parseFloat(o[3])}),o[4]&&Map.map.setZoom(parseInt(o[4],10)))}}else location.hash=e},l.goTab("map",0),_("body")[0].onkeyup=function(e){return 27!==e.which||l.goTab("map",0)},ready.push(function(){return function(){document.addEventListener("DOMContentLoaded",l.navigate,!1),window.onhashchange=l.navigate}})}(Nav);var Proximity={getCloseNodes:function(e,t){var p={lat:[e-1e-4,e+1e-4],lng:[t-1e-4,t+1e-4]};Geotile.loadBounds(p,function(e){var t=[],o={spot:0,event:1,group:2};for(var a in e)for(var n in e[a]){var r=e[a][n];r.lat>p.lat[0]&&r.lat<p.lat[1]&&r.lng>p.lng[0]&&r.lng<p.lng[1]&&t.push(r)}var i="";for(var s in t.sort(function(e,t){return o[e.type]-o[t.type]}),t){var l=t[s];i+='<a class="entry" onclick="Nav.navigate(\'#spot/'+l.id+'\');"><img class="type" src="'+Maps.icons[l.type].url+'">'+l.title+"</a>"}""!==i&&Maps.infoWindow.setContent(i)})}},Search={};!function(o){var p={};_("#search-submit").onclick=function(){var e=_("#search-text").value;Nav.navigate((/^(0|[1-9]\d*)$/.test(e)?"#spot/":"#search/")+encodeURIComponent(e))},_("#search-geocode").onclick=function(){var e=_("#search-text").value;Maps.geocode(e),Nav.navigate("")},o.loadSearch=function(e){var t=_("#search-text").value;/^(0|[1-9]\d*)$/.test(t)?Nav.navigate("#spot/"+t):(p.data={search:t,limit:e?p.data.limit+25:25},console.log(p),Http.get("//map.parkour.org/api/v1/spots/search",p.data,{Authorization:!1}).then(o.showPage))},o.showPage=function(e){var o='<div class="grid">';0===e.length&&(o+=t("no_results_found"));var a=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value;o+="<article onclick=\"Nav.navigate('#spot/"+l.id+"');\">",l.p0&&(o+='<div class="in-place cover" style="background-image: url(//map.parkour.org/images/spots/thumbnails/320px/'+l.p0+');"></div>'),o+='<div class="in-place title">',o+="<h1><span>"+strip(l.title)+"</span></h1>",o+="<p><span>"+strip(l.description).substring(0,100)+"</span></p>",o+="</div>",o+="</article>"}}catch(e){n=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw r}}e.length>=p.data.limit&&(o+='<article onclick="Search.loadSearch(true);"><div class="in-place title"><h1>'+t("search_show_more")+"</h1></div></article>",o+="</div>"),_("#search-page").innerHTML=o}}(Search);var Spot={};!function(m){m.spot={},ready.push(function(){return Nav.events.spot_hide=function(){return _("#map").className=""}}),m.loadSpot=function(u){Http.get("//map.parkour.org/api/v1/spot/"+u,null,{Authorization:!1}).then(function(e){var o=e.spot;m.spot={id:u,type:o.type,url_alias:o.url_alias},_("#spot-title").innerText=o.title||t("no_title"),_("#spot").className="spot-type-"+o.type;var a=t(o.type+"_type_"+o.category);e.spot_category_details&&e.spot_category_details.length&&(a+=" - "+e.spot_category_details.map(function(e){return t("spot_feature_"+e)}).join(", ")),_("#spot-type").innerText=a;var n="",r=new Date(1e3*o.created).toLocaleString();if(n=o.user_created?t("node_created_by",o.user_created)+" "+t("node_created_by_at",r):""+t("node_created_at",r),o.changed>o.created){var i=new Date(1e3*o.changed).toLocaleString();o.user_changed?n+=t("node_changed_by",o.user_changed)+" "+t("node_changed_by_at",i):n+=""+t("node_changed_at",i)}_("#spot-meta").innerText=n,_("#spot-body").innerHTML=o.description||t("no_body"),_("#spot-lat").innerHTML=o.lat,_("#spot-lng").innerHTML=o.lng,m.spot.lat=parseFloat(o.lat),m.spot.lng=parseFloat(o.lng);var s=!(n=""),l=!1,p=void 0;try{for(var c,d=e.images[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var g=c.value;n+='<a href="//map.parkour.org/images/spots/'+g.filename+'" target="_blank" /><img src="//map.parkour.org/images/spots/thumbnails/320px/'+g.filename+'" /></a>'}}catch(e){l=!0,p=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw p}}_("#spot-images").innerHTML=n||t("no_images"),Nav.goTab("spot"),m.spot.lat&&m.spot.lng?(_("#spot-geo").style.display="block",_("#spot-map").style.display="inline",_("#spot-maps-form").style.display="inline",_(".add-here").forEach(function(e){return e.style.display="inline-block"}),_("#spot-maps-formdata").value=m.spot.lat+","+m.spot.lng,_("#map").style.display="block",_("#map").className="half",Maps.panToPosition=!1,google.maps.event.addListenerOnce(Maps.map,"idle",function(){google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(m.spot),Maps.map.setZoom(15)}),console.log(m.spot),Nav.isLite&&Maps.newMarker(m.spot,!0),google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(m.spot),Maps.map.setZoom(15)):(_("#spot-geo").style.display="none",_("#spot-map").style.display="none",_("#spot-maps-form").style.display="none",_(".add-here").forEach(function(e){return e.style.display="none"}))},function(e){return Nav.error(t("error_load_spot"))})},m.find=function(e,t){var o=[t];e=e.split("|");var a=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value,p=new RegExp("^"+l+"$"),c=[],d=!0,g=!1,u=void 0;try{for(var m,f=o[Symbol.iterator]();!(d=(m=f.next()).done);d=!0){var v=m.value;for(var h in v)v.hasOwnProperty(h)&&p.test(h)&&c.push(v[h])}}catch(e){g=!0,u=e}finally{try{!d&&f.return&&f.return()}finally{if(g)throw u}}o=c}}catch(e){n=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw r}}return o},_("#spot-map").onclick=function(){Nav.navigate(""),Maps.map.setCenter(m.spot),Maps.map.setZoom(15)},_("#spot-web").onclick=function(){location.href="//map.parkour.org/"+m.spot.type+"/"+m.spot.url_alias}}(Spot),window.runLater(),window.addEventListener("load",function(){return setTimeout(function(){return window.scrollTo(0,1)},0)});