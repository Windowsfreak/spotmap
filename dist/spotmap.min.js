/*! spotmap - v0.2.11 - 2018-07-17
* https://github.com/windowsfreak/spotmap
* Copyright (c) 2018 Bj√∂rn Eberhardt; Licensed MIT */

"use strict";var _slicedToArray=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var o=[],a=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done)&&(o.push(i.value),!t||o.length!==t);a=!0);}catch(e){n=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw r}}return o}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(i){i.ready=[],i.runLater=function(){return(i.ready=i.ready.map(function(e){return"function"==typeof e&&e()}).filter(function(e){return e})).length&&i.runLater()},i._=function(e){return"#"===e[0]?document.getElementById(e.slice(1)):document.querySelectorAll(e)},i.dom=function(e){return document.createElement(e)},i.strip=function(e){var t=i.dom("DIV");return t.innerHTML=e,t.textContent||t.innerText||""},i.html=function(e){var t=i.dom("DIV");return t.innerText=e,t.innerHTML||""},i.t=function(e,t){return lang[e]||console.log("MISSING: "+e),lang[e]?lang[e].replace("\\1",t):"MISSING: "+e},i.setLang=function(e){localStorage.setItem("lang",e),location.reload()},i.t_html=function(){var e=!0,t=!1,o=void 0;try{for(var a,n=i._("*")[Symbol.iterator]();!(e=(a=n.next()).done);e=!0){var r=a.value;r.getAttribute("data-translate")&&(r[0<=["input","textarea","select"].indexOf(r.tagName.toLowerCase())?"placeholder":"innerHTML"]=i.t(r.getAttribute("data-translate")))}}catch(e){t=!0,o=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw o}}},i.script=function(e,t){var o=i.dom("script");o.type="text/javascript",o.async=!0,o.defer=!0,o.src=e;var a=i._("head")[0];o.addEventListener("load",function(e){t&&t(e),i.runLater()},!1),a.appendChild(o)},i.t_html()}(window);var Form={};!function(a){var e=!1;window.captcha=function(){grecaptcha.render("form-captcha",{sitekey:"6LdRg1cUAAAAAFjzUokSQB6egcNS_o9EF_KAmW7i",callback:a.save})},ready.push(function(){Nav.events.form_show=function(){e||(script("https://www.google.com/recaptcha/api.js?onload=captcha&render=explicit"),e=!0),_("#map").style.display="block",_("#map").className="half",Maps.map.setCenter(Maps.marker.getPosition()),google.maps.event.trigger(Maps.map,"resize"),google.maps.event.addListenerOnce(Maps.map,"idle",function(){google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(Maps.marker.getPosition())}),Http.getUser()||(Nav.success(t("error_login_required")),Nav.navigate("#login"))},Nav.events.form_hide=function(e){_("#map").className="",localStorage.getItem("form_text")&&!e&&Nav.success(t("draft_saved"))}}),a.add_here=function(e){Spot.map(),Maps.newMarker(Spot.spot,!0),a.add(e)},a.add=function(o){var e={spot:t("new_spot"),group:t("new_group"),event:t("new_event")};_("#form-type").innerText=e[o],_("#form-category").innerHTML='<option value="" disabled selected hidden>'+t("form_category")+"</option>"+Maps.categories[o].map(function(e){return'<option value="'+e+'">'+t(o+"_type_"+e)+"</option>"}).join(""),_("#form-category").value="",Spot.marker={lat:Maps.marker.getPosition().lat(),lng:Maps.marker.getPosition().lng(),type:o},Nav.goTab("form")},a.backup=function(){localStorage.setItem("form_title",_("#form-title").value),localStorage.setItem("form_text",_("#form-text").value),Maps.marker&&(localStorage.setItem("form_lat",Maps.marker.getPosition().lat()),localStorage.setItem("form_lng",Maps.marker.getPosition().lng())),Spot.marker&&localStorage.setItem("form_type",Spot.marker.type)},a.restore=function(){localStorage.getItem("form_text")&&(_("#form-title").value=localStorage.getItem("form_title"),_("#form-text").value=localStorage.getItem("form_text"),Spot.marker={lat:parseFloat(localStorage.getItem("form_lat")),lng:parseFloat(localStorage.getItem("form_lng")),type:localStorage.getItem("form_type")},window.panToPosition=!1,Maps.newMarker(Spot.marker,!0),Maps.map.panTo(Spot.marker),a.add(Spot.marker.type),google.maps.event.addListenerOnce(Maps.map,"idle",function(){Maps.map.panTo(Maps.marker.getPosition())}),Nav.success(t("draft_restored")))},a.remove=function(e){(e||confirm(t("draft_delete_confirm")))&&(localStorage.removeItem("form_title"),localStorage.removeItem("form_text"),localStorage.removeItem("form_lat"),localStorage.removeItem("form_lng"),localStorage.removeItem("form_type"),_("#form-title").value="",_("#form-text").value="",Nav.goTab("map",0),e||Nav.success(t("draft_deleted")))},a.save=function(){if(_("#form-category").value){var e=grecaptcha.getResponse();e?(!function(e){Nav.success(t("in_progress"));var o=Http.getUser();Http.post("//map.parkour.org/api/v1/spot",JSON.stringify({type:Spot.marker.type,category:_("#form-category").value,title:_("#form-title").value,description:html(_("#form-text").value),lat:Spot.marker.lat,lng:Spot.marker.lng,user_created:o}),{"Content-Type":"application/json","X-CSRF-Token":e,"X-Username":o}).then(function(e){Nav.success(t("node_added")),Nav.navigate("#spot/"+e.id),a.remove(!0),Geotile.update(Spot.marker.lat,Spot.marker.lng),Maps.handleBoundsChanged()},function(e){return Nav.error(t(403===e.status||401===e.status?"error_forbidden":"error_add_node")+" "+e.message)})}(e),grecaptcha.reset()):grecaptcha.execute()}else Nav.error(t("form_category"))}}(Form);var Geohash={};!function(c){c.BITS=[16,8,4,2,1],c.BASE32="0123456789bcdefghjkmnpqrstuvwxyz",c.NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}},c.BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}},c.NEIGHBORS.bottom.odd=c.NEIGHBORS.left.even,c.NEIGHBORS.top.odd=c.NEIGHBORS.right.even,c.NEIGHBORS.left.odd=c.NEIGHBORS.bottom.even,c.NEIGHBORS.right.odd=c.NEIGHBORS.top.even,c.BORDERS.bottom.odd=c.BORDERS.left.even,c.BORDERS.top.odd=c.BORDERS.right.even,c.BORDERS.left.odd=c.BORDERS.bottom.even,c.BORDERS.right.odd=c.BORDERS.top.even,c.refineInterval=function(e,t,o){return e[t&o?0:1]=(e[0]+e[1])/2},c.adjacent=function(e,t){var o=(e=e.toLowerCase()).charAt(e.length-1),a=e.length%2?"odd":"even",n=e.substring(0,e.length-1);return(-1!==c.BORDERS[t][a].indexOf(o)?c.adjacent(n,t):n)+c.BASE32[c.NEIGHBORS[t][a].indexOf(o)]},c.decode=function(e){var t=1,o=[],a=[];o[0]=-90,o[1]=90,a[0]=-180;a[1]=180;for(var n=0;n<e.length;n++)for(var r=e[n],i=c.BASE32.indexOf(r),s=0;s<5;s++){var l=c.BITS[s];t?(2,c.refineInterval(a,i,l)):(2,c.refineInterval(o,i,l)),t=!t}return o[2]=(o[0]+o[1])/2,a[2]=(a[0]+a[1])/2,{lat:o,lng:a}},c.encode=function(e,t){var o=1,a=[],n=[],r=0,i=0,s="";for(a[0]=-90,a[1]=90,n[0]=-180,n[1]=180;s.length<12;){if(o){var l=(n[0]+n[1])/2;l<t?(i|=c.BITS[r],n[0]=l):n[1]=l}else{var p=(a[0]+a[1])/2;p<e?(i|=c.BITS[r],a[0]=p):a[1]=p}o=!o,r<4?r++:(s+=c.BASE32[i],i=r=0)}return s}}(Geohash);var Geotile={};!function(S){var N={},x=[[180,360],[45,45],[5.625,11.25],[1.40625,1.40625],[.17578125,.3515625],[.0439453125,.0439453125],[.0054931640625,.010986328125],[.001373291015625,.001373291015625],[.000171661376953125,.00034332275390625],[4291534423828125e-20,4291534423828125e-20],[5364418029785156e-21,10728836059570312e-21],[1341104507446289e-21,1341104507446289e-21],[1.6763806343078613e-7,3.3527612686157227e-7]];S.onlyUnique=function(e,t,o){return o.indexOf(e)===t},S.extend=function(e,t){var o=e.slice(0),a=!0,n=!1,r=void 0;try{for(var i,s=o[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value;e.push(Geohash.adjacent(l,t))}}catch(e){n=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw r}}return e.filter(S.onlyUnique)},S.filter=function(e,t){var o={};for(var a in e)if(e.hasOwnProperty(a)){var n=t(a,e[a]);void 0!==n&&(o[a]=n)}return o},S.update=function(e,t){for(var o=Geohash.encode(e,t),a=0;a<16;a++)for(var n=o.substring(0,a),r=-1;r<=5;r++)N[r]&&delete N[r][n]},S.loadBounds=function(e,o){var a=void 0,n={lat:(a=e.lat?e:{lat:[(a={sw:e.getSouthWest(),ne:e.getNorthEast()}).sw.lat(),a.ne.lat()],lng:[a.sw.lng(),a.ne.lng()]}).lat.slice(0),lng:a.lng.slice(0)};n.lng[1]<n.lng[0]&&(n.lng[1]+=360),360<n.lng[0]+n.lng[1]&&(n.lng[1]-=360,n.lng[0]-=360);var r=[n.lat[1]-n.lat[0],n.lng[1]-n.lng[0]],i=_("#map"),s=void 0,l=Math.min(2400*r[0]/i.offsetHeight,2400*r[1]/i.offsetWidth);(5<(s=23<l?0:2.8<l?1:.7<l?2:.087<l?3:.022<l?4:.0027<l?5:6)||s<0)&&(s=-1);for(var p=12;0<p--&&!(x[p][0]>r[0]/3&&x[p][1]>r[1]/3););p++;for(var c=void 0;0<p;){var d=x[--p],u=Geohash.encode((n.lat[0]+n.lat[1])/2,(n.lng[0]+n.lng[1])/2).substring(0,p);c=[u];var g=Geohash.decode(u);if(g.lat[0]>a.lat[0]){if(g.lat[0]-d[0]>a.lat[0])continue;c=S.extend(c,"bottom")}if(g.lat[1]<a.lat[1]){if(g.lat[1]+d[0]<a.lat[1])continue;c=S.extend(c,"top")}if(g.lng[0]>a.lng[0]){if(g.lng[0]-d[1]>a.lng[0])continue;c=S.extend(c,"left")}if(g.lng[1]<a.lng[1]){if(g.lng[1]+d[1]<a.lng[1])continue;c=S.extend(c,"right")}break}N[s]||(N[s]={});var m={},f=!0,v=!1,h=void 0;try{for(var y,w=c[Symbol.iterator]();!(f=(y=w.next()).done);f=!0){var b=y.value;m[b]=N[s][b]}}catch(e){v=!0,h=e}finally{try{!f&&w.return&&w.return()}finally{if(v)throw h}}var k=Object.keys(S.filter(m,function(e,t){return void 0===t?e:void 0})).map(function(e){return e});return k.length&&Http.get("//map.parkour.org/query5j.php",{tiles:k.join(","),zoom:s},{Authorization:!1}).then(function(e){Object.assign(N[s],e),Object.assign(m,e),o(m)},function(){return Nav.error(t("error_load_spotmap"))}),o(m),m}}(Geotile);var Help={};!function(o){ready.push(function(){return Nav.events.help_show=function(e){return o.previous="help"!==e?e:o.previous}}),o.display=function(e){_("#help-title").innerText=e.title||"",_("#help-body").innerHTML=e.body||"",Nav.goTab("help")},o.show=function(e){return Http.get("./static/"+e+"_"+l+".json",void 0,{Authorization:!1}).then(o.display,function(e){return Nav.error(t("no_results_found"))})},o.close=function(){return Help.previous?Nav.goTab(Help.previous):Nav.resetTab()}}(Help);var Http={};!function(a){a.b64a=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))},a.retr=function(e){return localStorage.getItem(e)},a.stor=function(e,t){return localStorage.setItem(e,t)},a.getUser=function(){return localStorage.getItem("d8_user")},a.getCredentials=function(){return"Basic Og=="},a.setCredentials=function(e){localStorage.setItem("d8_user",e)},a.deleteCredentials=function(){localStorage.removeItem("d8_user")},a.http=function(n,r,i){var s=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};return!1===s.Authorization?delete s.Authorization:s.user?(s.Authorization="Basic "+a.b64a(s.user+":"+s.pass),delete s.user,delete s.pass):r.match(/^(https?:)?\/\/(www\.)?map\.parkour\.org\/?/)&&(s.Authorization=a.getCredentials()),new Promise(function(e,o){var a=new XMLHttpRequest;a.open(n,r),a.onload=function(){if(200<=this.status&&this.status<300)try{e("text/html"===s.accept?a.response:JSON.parse(a.response))}catch(e){Nav.error(t("error_server_request")),o({method:n,url:r,params:i,headers:s,status:this.status,statusText:a.statusText,message:a.response})}else a.onerror()},a.onerror=function(){Nav.error(t("error_server_request")),o({method:n,url:r,params:i,headers:s,status:this.status,statusText:a.statusText,message:a.response})},s&&Object.keys(s).forEach(function(e){return a.setRequestHeader(e,s[e])}),i&&"object"===(void 0===i?"undefined":_typeof(i))?a.send(Object.keys(i).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(i[e])}).join("&")):a.send(i)})},a.get=function(e,t,o){return t&&"object"===(void 0===t?"undefined":_typeof(t))?a.http("GET",e+(0<e.indexOf("?")?"&":"?")+Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),void 0,o):t?a.http("GET",e+(0<e.indexOf("?")?"&":"?")+t,void 0,o):a.http("GET",e,t,o)},a.post=function(e,t,o){return a.http("POST",e,t,o)},a.patch=function(e,t,o){return a.http("PATCH",e,t,o)},a.del=function(e,t,o){return a.http("REMOVE",e,t,o)}}(Http);var Login={};ready.push(function(){Nav.events.login_show=function(){null!==Http.getUser()?(Nav.goTab("logout-form"),_("#username").innerText=Http.getUser()):Nav.goTab("login-form")},_("#login-submit").onclick=function(){var e=_("#login-username");Http.setCredentials(e.value),Nav.success(t("logged_in_as",e.value)),e.value="",Nav.events.login_show()},_("#logout-submit").onclick=function(){Http.deleteCredentials(),Nav.events.login_show()}});var Maps={};!function(b){ready.push(function(){Nav.events.map_show=function(){if(window.google){var e=b.map.getCenter();google.maps.event.trigger(b.map,"resize"),b.map.setCenter(e)}else b.gdpr()},window.mapScripts=!0,window.mapLoaded?b.initMapInternal():b.gdpr()}),b.mapped=function(e){return e.startsWith("#map/")||e.startsWith("#spot/")};var o=Date.now;b.categories={spot:["outdoor","gym","parkourpark","parkourgym","climbinggym","pool","cliff"],event:["training","workshop","jam","trip","competition"],group:["private","community","club","company"],move:["moves","conditioning","games","jumps","vaults","bar","flips","combinations","freezes","beginner","intermediate","advanced"]},window.panToPosition=!b.mapped(location.hash),b.filter=Object.values(b.categories).reduce(function(e,t){return e.concat(t)},[]);var a=void 0;b.icons={},b.shapes={},b.gdpr=function(){1!==parseInt(Http.retr("gdpr"))?Help.show("gdpr"):b.accept()},b.accept=function(){window.mapLoaded||window.mapLoading||(script("//maps.google.com/maps/api/js?key=AIzaSyDWsl8SdI_0q21fkJRM6dwxr11uO23bihw&callback=initMap"),window.mapLoading=!0),Http.stor("gdpr",1)},b.setGpsObj=function(e){a&&a.setMap(null),a=new google.maps.Circle({strokeColor:"#0000FF",strokeOpacity:.4,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.1,map:b.map,center:{lat:e.coords.latitude,lng:e.coords.longitude},radius:e.coords.accuracy,position:e,clickable:!1})},b.updateGpsObj=function(e){return!!window.mapLoaded&&((!a||a.position.coords.accuracy>e.coords.accuracy||a.position.timestamp<e.timestamp-3e3)&&(b.setGpsObj(e),!0))},b.pan=function(e){var t=function(){b.map.panTo({lat:e.coords.latitude,lng:e.coords.longitude}),b.map.setZoom(e.coords.accuracy<200?17:e.coords.accuracy<500?16:e.coords.accuracy<2e3?15:13)};t(),google.maps.event.addListenerOnce(b.map,"idle",t)},b.track=function(t){"yes"===t&&(window.panToPosition=!0,Nav.goTab("map",0));var e=function(e){b.updateGpsObj(e)&&(t||Date.now()<o+1e4)&&("yes"!==t&&b.mapped(location.hash)&&!window.panToPosition||b.pan(e))};try{navigator.geolocation.getCurrentPosition(e,function(){return!1},{timeout:250}),navigator.geolocation.getCurrentPosition(e,function(){return!1},{enableHighAccuracy:!0})}catch(e){Nav.error("The browser is too old, Geolocation is not supported.")}},b.markers={},b.load=function(e,o){var a=e.type.startsWith("multi"),n=new google.maps.Marker({id:e.id,map:b.map,title:a?e.title+" "+t("btn_spots")+"\n"+e.category.replace(/^multi,/,"").replace(/,/g,", "):e.title,position:{lat:e.lat,lng:e.lng},data:e,icon:a?b.icons.zoom:e.type.includes("group")?b.icons.group:e.type.includes("event")?b.icons.event:b.icons.spot,shape:a?b.shapes.zoom:b.shapes.spot});o.push(n),google.maps.event.addListener(n,"click",b.show)},b.show=function(e){if((!e||e.latLng||e.pixel)&&(e=this),"add"===e.data.category){if(Nav.isLite)return;b.map.panTo(e.getPosition()),b.infoWindow.setContent('\n            <button type="button" onclick="Form.add(\'spot\')">&#x2795; '+t("spot")+'</button>\n            <button type="button" onclick="Form.add(\'event\')">&#x2795; '+t("event")+'</button>\n            <button type="button" onclick="Form.add(\'group\')">&#x2795; '+t("group")+"</button>"),b.infoWindow.open(b.map,e)}else if(e.data.category.startsWith("multi"))b.infoWindow.close(),b.map.panTo(e.getPosition()),b.map.setZoom(b.map.getZoom()+2);else{var o=e.data.type.startsWith("multi")?b.icons.zoom:e.data.type.includes("group")?b.icons.group:e.data.type.includes("event")?b.icons.event:b.icons.spot;b.infoWindow.setContent("<a onclick=\"Nav.navigate('#spot/"+e.data.id+'\');" class="entry"><img class="type" src="'+o.url+'">'+e.data.title+"</a>"),b.infoWindow.setPosition(e.getPosition()),b.infoWindow.open(b.map),Proximity.getCloseNodes(e.data.lat,e.data.lng)}},b.loadAll=function(e){for(var t in e)if(!b.markers[t]||e[t]&&b.markers[t].length!==e[t].length){var o=[];for(var a in e[t])b.matchesFilter(e[t][a])&&b.load(e[t][a],o);if(b.markers[t])for(var n in b.markers[t])b.markers[t][n].setMap(null);b.markers[t]=o}for(var r in b.markers)if(!e[r]){for(var i in b.markers[r])b.markers[r][i].setMap(null);delete b.markers[r]}};var n=null;b.handleBoundsChanged=function(){var e=b.map.getBounds();Geotile.loadBounds(e,b.loadAll),clearTimeout(n),n=setTimeout(function(){var e=b.map.getCenter(),t="#map/"+e.lat().toFixed(5)+"/"+e.lng().toFixed(5)+"/"+b.map.getZoom();(location.hash.startsWith("#map/")||""===location.hash)&&location.hash!==t&&history.replaceState({},"",t),localStorage.setItem("pos",t)},400)},b.initMapInternal=function(){var e=location.hash,t=new google.maps.LatLngBounds({lat:49,lng:6},{lat:55,lng:15});if(b.map=new google.maps.Map(_("#map"),{center:{lat:51.5167,lng:9.9167},zoom:7}),b.geocoder=new google.maps.Geocoder,e.startsWith("#map/")){var o=/#(\w+)\/([^/]*)\/([^/]*)(?:\/([^/]*))?/g.exec(e);b.map.setCenter({lat:parseFloat(o[2]),lng:parseFloat(o[3])}),o[4]&&b.map.setZoom(parseInt(o[4],10))}else if(window.panToPosition)if(localStorage.getItem("pos")){var a=localStorage.getItem("pos").split("/");b.map.setCenter({lat:parseFloat(a[1]),lng:parseFloat(a[2])}),b.map.setZoom(parseInt(a[3]))}else b.map.fitBounds(t);else b.map.setZoom(15),void 0!==Spot.spot.lat&&b.map.setCenter(Spot.spot);google.maps.event.addDomListener(window,"resize",function(){var e=b.map.getCenter();google.maps.event.trigger(b.map,"resize"),b.map.setCenter(e)}),google.maps.event.addListener(b.map,"bounds_changed",b.handleBoundsChanged),google.maps.event.addListener(b.map,"click",b.newMarker);var n=dom("div");b.createFilter(n),n.index=1,b.map.controls[google.maps.ControlPosition.LEFT_TOP].push(n),b.icons.event={url:"images/green.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},b.icons.group={url:"images/purple.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},b.icons.spot={url:"images/logo32.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},b.shapes.spot={coords:[15,0,31,7,15,31,0,7,15,0],type:"poly"},b.icons.zoom={url:"images/multi.png",size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,8)},b.shapes.zoom={coords:[11,0,14,1,16,3,18,5,18,13,18,15,24,20,24,23,15,19,7,18,1,15,0,7,3,2,7,0,11,0],type:"poly"},b.icons.crosshair={url:"images/crosshair.png",size:new google.maps.Size(49,49),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(24,24)},b.infoWindow=new google.maps.InfoWindow({content:"Some address here..",maxWidth:500,pixelOffset:new google.maps.Size(0,-31)}),b.mapped(location.hash)&&!window.panToPosition||b.track(!0),Form.restore()},b.geocode=function(e){b.geocoder.geocode({address:e},function(e,o){o===google.maps.GeocoderStatus.OK?(b.newMarker({latLng:e[0].geometry.location},!0),b.map.setCenter(e[0].geometry.location),b.map.setZoom(15)):Nav.error(t("error_geocode")+" "+o)})},b.newMarker=function(e,o){e.latLng||(e.latLng={lat:e.lat,lng:e.lng}),!o&&Nav.isLite||(!o&&b.map.getZoom()<14?Nav.success(t("zoom")):(b.marker?b.marker.setPosition(e.latLng):(b.marker=new google.maps.Marker({position:e.latLng,map:b.map,title:t("new_marker"),icon:b.icons.crosshair,draggable:!Nav.isLite,data:{category:"add"}}),b.marker.addListener("drag",b.dragMarker),b.marker.addListener("dragend",b.endMarker),b.marker.addListener("click",b.show),b.show(b.marker)),b.dragMarker(),Form.backup()))},b.dragMarker=function(e){return Nav.success(t("position")+": "+b.marker.getPosition().lat().toFixed(5)+" "+b.marker.getPosition().lng().toFixed(5))},b.endMarker=function(e){b.map.panTo(b.marker.getPosition()),Form.backup()},b.clickMarker=function(e){return b.show(b.marker)},b.createFilter=function(e){e.className="filterDiv";var o=dom("div");o.className="filterBtn",o.innerHTML="&#9881;",e.appendChild(o);var a=dom("div");a.className="filterBox none",e.appendChild(a);var n="Zeige:<br />",r=!0,i=!1,s=void 0;try{for(var l,p=Object.entries(b.categories)[Symbol.iterator]();!(r=(l=p.next()).done);r=!0){var c=l.value,d=_slicedToArray(c,2),u=d[0],g=d[1];if("move"!==u){n+="<p><b>"+t("type_"+u)+"</b><br />";var m=!0,f=!1,v=void 0;try{for(var h,y=g[Symbol.iterator]();!(m=(h=y.next()).done);m=!0){var w=h.value;n+='<span class="yes" id="filter-'+w+'" onclick="Maps.toggleFilter(\''+w+"')\">"+t(u+"_type_"+w)+"</span><br />"}}catch(e){f=!0,v=e}finally{try{!m&&y.return&&y.return()}finally{if(f)throw v}}n+="</p>"}}}catch(e){i=!0,s=e}finally{try{!r&&p.return&&p.return()}finally{if(i)throw s}}a.innerHTML=n,o.addEventListener("click",function(){var e=_(".filterBox")[0];e.className="filterBox"===e.className?"filterBox none":"filterBox"})},b.toggleFilter=function(e){var t=_("#filter-"+e);if(t.className="yes"===t.className?"no":"yes","yes"===t.className)b.filter.includes(e)||b.filter.push(e);else{var o=b.filter.indexOf(e);-1!==o&&b.filter.splice(o,1)}b.loadAll([]),b.handleBoundsChanged()},b.matchesFilter=function(e){var t=!0,o=!1,a=void 0;try{for(var n,r=b.filter[Symbol.iterator]();!(t=(n=r.next()).done);t=!0){var i=n.value;if(-1!==e.category.indexOf(i))return!0}}catch(e){o=!0,a=e}finally{try{!t&&r.return&&r.return()}finally{if(o)throw a}}return!1}}(Maps);var Nav={};!function(p){p.events={},p.isLite=!1,p.openTab=function(e,t){for(var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:_("#"+e).parentNode||_("#content"),a=_("section"),n=void 0,r=0;r<a.length;r++)a[r].parentNode===o&&("block"===a[r].style.display&&(n=a[r].id,console.log("Hiding  "+a[r].id),p.call(p.events[a[r].id+"_hide"],e===a[r].id)),a[r].style.display="none");if(t){for(var i=_("button"),s=0;s<i.length;s++)i[s].className=i[s].className.replace(" active","");t.currentTarget.className+=" active"}var l=_("#"+e);return l&&(l.style.display="block",o.className=e+"-page",console.log("Showing "+e),p.call(p.events[e+"_show"],n)),l},p.call=function(e,t){return e&&e(t)},p.goTab=function(e,t){return p.openTab(e,void 0!==t?{currentTarget:_("button")[t]}:void 0)},p.resetTab=function(){return p.navigate("")},p.notice=function(e,t){window.noticeHideTimeout&&p.noticeHide(),_("#notice").className=t+" show",_("#notice-text").innerText=e,window.noticeHideTimeout=window.setTimeout(p.noticeHide,4e3)},p.error=function(e){return p.notice(e,"error")},p.success=function(e){return p.notice(e,"success")},p.noticeHide=function(e){_("#notice").className+=e?" vanish":" hide",window.noticeHideTimeout&&(window.clearTimeout(window.noticeHideTimeout),delete window.noticeHideTimeout)},p.navigate=function(e){if("string"!=typeof e){if((e=location.hash).startsWith("#event/")||e.startsWith("#group/")||e.startsWith("#move/")||e.startsWith("#page/")||e.startsWith("#post/")||e.startsWith("#spot/")){var t=/#(\w+)\/(\d+)(?:\/(.*))?/g.exec(e);"lite"===t[3]&&(_("body")[0].className="lite",p.isLite=!0),Spot.loadSpot(t[2])}else if(e.startsWith("#login"))p.goTab("login",2);else if(e.startsWith("#search"))p.goTab("search",1),e.startsWith("#search/")&&(_("#search-text").value=decodeURIComponent(/#(\w+)\/(.*)/g.exec(e)[2]),Search.loadSearch());else if((""===e||e.startsWith("#map/"))&&(p.goTab("map",0),e.startsWith("#map/"))){var o=/#(\w+)\/([^/]*)\/([^/]*)(?:\/([^/]*))?/g.exec(e);Map.map&&(Map.map.panTo({lat:parseFloat(o[2]),lng:parseFloat(o[3])}),o[4]&&Map.map.setZoom(parseInt(o[4],10)))}}else location.hash=e},window.doNotLoad||p.goTab("map",0),ready.push(function(){return function(){document.addEventListener("DOMContentLoaded",p.navigate,!1),window.onhashchange=p.navigate,_("body")[0].onkeyup=function(e){return 27!==e.which||p.goTab("map",0)}}})}(Nav);var Proximity={getCloseNodes:function(e,t){var p={lat:[e-1e-4,e+1e-4],lng:[t-1e-4,t+1e-4]};Geotile.loadBounds(p,function(e){var t=[],o={spot:0,event:1,group:2};for(var a in e)for(var n in e[a]){var r=e[a][n];r.lat>p.lat[0]&&r.lat<p.lat[1]&&r.lng>p.lng[0]&&r.lng<p.lng[1]&&t.push(r)}var i="";for(var s in t.sort(function(e,t){return o[e.type]-o[t.type]}),t){var l=t[s];i+='<a class="entry" onclick="Nav.navigate(\'#spot/'+l.id+'\');"><img class="type" src="'+Maps.icons[l.type].url+'">'+l.title+"</a>"}""!==i&&Maps.infoWindow.setContent(i)})}},Search={};!function(o){var p={};ready.push(function(){_("#search-submit").onclick=function(){var e=_("#search-text").value;Nav.navigate((/^(0|[1-9]\d*)$/.test(e)?"#spot/":"#search/")+encodeURIComponent(e))},_("#search-geocode").onclick=function(){var e=_("#search-text").value;Maps.geocode(e),Nav.navigate("")}}),o.loadSearch=function(e){var t=_("#search-text").value;/^(0|[1-9]\d*)$/.test(t)?Nav.navigate("#spot/"+t):(p.data={search:t,limit:e?p.data.limit+25:25},Http.get("//map.parkour.org/api/v1/spots/search",p.data,{Authorization:!1}).then(o.showPage))},o.showPage=function(e){var o='<div class="grid">';0===e.length&&(o+=t("no_results_found"));var a=!0,n=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var l=i.value;o+="<article onclick=\"Nav.navigate('#spot/"+l.id+"');\">",l.p0&&(o+='<div class="in-place cover" style="background-image: url(//map.parkour.org/images/spots/thumbnails/320px/'+l.p0+');"></div>'),o+='<div class="in-place title">',o+="<h1><span>"+strip(l.title)+"</span></h1>",o+="<p><span>"+strip(l.description).substring(0,100)+"</span></p>",o+="</div>",o+="</article>"}}catch(e){n=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(n)throw r}}e.length>=p.data.limit&&(o+='<article onclick="Search.loadSearch(true);"><div class="in-place title"><h1>'+t("search_show_more")+"</h1></div></article>"),_("#search-page").innerHTML=o+"</div>"}}(Search);var Spot={};!function(m){m.spot={},ready.push(function(){Nav.events.spot_hide=function(){return _("#map").className=""},_("#spot-lat").title=t("label_lat"),_("#spot-lng").title=t("label_lng"),_("#spot-map").onclick=m.map,_("#spot-edit").onclick=function(){return location.href="//map.parkour.org/"+m.spot.type+"/"+m.spot.url_alias+"/edit"}}),m.map=function(){window.mapLoaded&&(Nav.navigate(""),Maps.map.setCenter(m.spot),Maps.map.setZoom(15))},m.loadSpot=function(g){Http.get("//map.parkour.org/api/v1/spot/"+g,null,{Authorization:!1}).then(function(e){var o=e.spot;m.spot={id:g,type:o.type,url_alias:o.url_alias},_("#spot-title").innerText=o.title||"",_("#spot").className="spot-type-"+o.type;var a=t(o.type+"_type_"+o.category);e.spot_category_details&&e.spot_category_details.length&&(a+=" - "+e.spot_category_details.map(function(e){return t("spot_feature_"+e)}).join(", ")),_("#spot-type").innerText=a;var n="",r=new Date(1e3*o.created).toLocaleString();if(n+=o.user_created?t("node_created_by",o.user_created)+" "+t("node_created_by_at",r):""+t("node_created_at",r),o.changed>o.created){var i=new Date(1e3*o.changed).toLocaleString();n+=o.user_changed?t("node_changed_by",o.user_changed)+" "+t("node_changed_by_at",i):""+t("node_changed_at",i)}_("#spot-meta").innerText=n,_("#spot-body").innerHTML=o.description||"",_("#spot-body").style.display=o.description?"block":"none",_("#spot-lat").innerHTML=o.lat,_("#spot-lng").innerHTML=o.lng,m.spot.lat=parseFloat(o.lat),m.spot.lng=parseFloat(o.lng);var s=!(n=""),l=!1,p=void 0;try{for(var c,d=e.images[Symbol.iterator]();!(s=(c=d.next()).done);s=!0){var u=c.value;n+='<a href="//map.parkour.org/images/spots/'+u.filename+'" target="_blank" /><img src="//map.parkour.org/images/spots/thumbnails/320px/'+u.filename+'" /></a>'}}catch(e){l=!0,p=e}finally{try{!s&&d.return&&d.return()}finally{if(l)throw p}}_("#spot-images").innerHTML=n||"",_("#spot-images").style.display=n?"block":"none",Nav.goTab("spot"),m.spot.lat&&m.spot.lng?(_("#spot-geo").style.display="block",_("#spot-map").style.display="inline",_("#spot-maps-form").style.display="inline",_(".add-here").forEach(function(e){return e.style.display="inline-block"}),_("#spot-maps-formdata").value=m.spot.lat+","+m.spot.lng,_("#map").style.display="block",_("#map").className="half",Maps.panToPosition=!1,window.mapLoaded&&(Nav.isLite&&Maps.newMarker(m.spot,!0),google.maps.event.addListenerOnce(Maps.map,"idle",function(){google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(m.spot),Maps.map.setZoom(15)}),google.maps.event.trigger(Maps.map,"resize"),Maps.map.setCenter(m.spot),Maps.map.setZoom(15))):(_("#spot-geo").style.display="none",_("#spot-map").style.display="none",_("#spot-maps-form").style.display="none",_(".add-here").forEach(function(e){return e.style.display="none"}))},function(e){return Nav.error(t("error_load_spot"))})}}(Spot),window.doNotLoad||window.runLater(),window.addEventListener("load",function(){return setTimeout(function(){return window.scrollTo(0,1)},0)});