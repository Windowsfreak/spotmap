/*! spotmap - v0.1.0 - 2017-02-17
* https://github.com/windowsfreak/spotmap
* Copyright (c) 2017 Bj√∂rn Eberhardt; Licensed MIT */
"use strict";function _(a){return"#"==a[0]?document.getElementById(a.slice(1)):document.querySelectorAll(a)}function strip(a){var b=document.createElement("DIV");return b.innerHTML=a,b.textContent||b.innerText||""}function t(a){return lang[a]||console.log("MISSING: "+a),lang[a]?lang[a].replace("\\1",arguments[1]):"MISSING: "+a}function setLang(a){localStorage.setItem("lang",a),location.reload()}function add_here(a){newMarker({latLng:{lat:spots.spot.lat,lng:spots.spot.lng}},!0),add(a)}function add(a){var b={spot:t("new_spot"),group:t("new_group"),event:t("new_event")};_("#form-type").innerText=b[a],spots.marker={lat:marker.getPosition().lat(),lng:marker.getPosition().lng(),type:a},goTab("form")}function backup(){localStorage.setItem("form_title",_("#form-title").value),localStorage.setItem("form_text",_("#form-text").value),localStorage.setItem("form_lat",marker.getPosition().lat()),localStorage.setItem("form_lng",marker.getPosition().lng()),spots.marker&&localStorage.setItem("form_type",spots.marker.type)}function restore(){localStorage.getItem("form_text")&&(_("#form-title").value=localStorage.getItem("form_title"),_("#form-text").value=localStorage.getItem("form_text"),spots.marker={lat:parseFloat(localStorage.getItem("form_lat")),lng:parseFloat(localStorage.getItem("form_lng")),type:localStorage.getItem("form_type")},window.panToPosition=!1,newMarker({latLng:{lat:spots.marker.lat,lng:spots.marker.lng}},!0),map.panTo({lat:spots.marker.lat,lng:spots.marker.lng}),add(spots.marker.type),google.maps.event.addListenerOnce(map,"idle",function(){map.panTo(marker.getPosition())}),success(t("draft_restored")))}function remove(a){(a||confirm(t("draft_delete_confirm")))&&(localStorage.removeItem("form_title"),localStorage.removeItem("form_text"),localStorage.removeItem("form_lat"),localStorage.removeItem("form_lng"),localStorage.removeItem("form_type"),_("#form-title").value="",_("#form-text").value="",goTab("map",0),a||success(t("draft_deleted")))}function save(){get("//www.parkour.org/rest/session/token",void 0,{Authorization:!1}).then(function(a){success(t("in_progress")),post("//www.parkour.org/entity/node?_format=hal_json",JSON.stringify({_links:{type:{href:"http://www.parkour.org/rest/type/node/"+spots.marker.type}},type:[{target_id:spots.marker.type}],title:[{value:_("#form-title").value}],body:[{value:_("#form-text").value}],field_location:[{lat:spots.marker.lat,lon:spots.marker.lng,value:"POINT ("+spots.marker.lng+" "+spots.marker.lat+")"}]}),{"Content-Type":"application/hal+json","X-CSRF-Token":a.message}).then(function(a){success(t("node_added")),location.href="//www.parkour.org/de/node/"+find("nid|\\d+|value",a)[0]+"/edit",remove(!0)},function(a){error(403==a.status||401==a.status?t("error_forbidden"):t("error_add_node")),console.log(a)})},function(){error(t("error_add_node"))})}function refine_interval(a,b,c){b&c?a[0]=(a[0]+a[1])/2:a[1]=(a[0]+a[1])/2}function calculateAdjacent(a,b){a=a.toLowerCase();var c=a.charAt(a.length-1),d=a.length%2?"odd":"even",e=a.substring(0,a.length-1);return BORDERS[b][d].indexOf(c)!=-1&&(e=calculateAdjacent(e,b)),e+BASE32[NEIGHBORS[b][d].indexOf(c)]}function decodeGeoHash(a){var b=1,c=[],d=[];c[0]=-90,c[1]=90,d[0]=-180,d[1]=180;for(var e=90,f=180,g=0;g<a.length;g++)for(var h=a[g],i=BASE32.indexOf(h),j=0;j<5;j++){var k=BITS[j];b?(f/=2,refine_interval(d,i,k)):(e/=2,refine_interval(c,i,k)),b=!b}return c[2]=(c[0]+c[1])/2,d[2]=(d[0]+d[1])/2,{lat:c,lng:d}}function encodeGeoHash(a,b){var c=1,d=[],e=[],f=0,g=0,h=12,i="";for(d[0]=-90,d[1]=90,e[0]=-180,e[1]=180;i.length<h;){if(c){var j=(e[0]+e[1])/2;b>j?(g|=BITS[f],e[0]=j):e[1]=j}else{var k=(d[0]+d[1])/2;a>k?(g|=BITS[f],d[0]=k):d[1]=k}c=!c,f<4?f++:(i+=BASE32[g],f=0,g=0)}return i}function onlyUnique(a,b,c){return c.indexOf(a)===b}function extend(a,b){var c=a.slice(0),d=!0,e=!1,f=void 0;try{for(var g,h=c[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value;a.push(calculateAdjacent(i,b))}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return a.filter(onlyUnique)}function filter(a,b){var c={};for(var d in a)if(a.hasOwnProperty(d)){var e=b(d,a[d]);void 0!==e&&(c[d]=e)}return c}function loadBounds(a,b){var c=void 0;a.lat?c=a:(c={sw:a.getSouthWest(),ne:a.getNorthEast()},c={lat:[c.sw.lat(),c.ne.lat()],lng:[c.sw.lng(),c.ne.lng()]});var d={lat:c.lat.slice(0),lng:c.lng.slice(0)};d.lng[1]<d.lng[0]&&(d.lng[1]+=360),d.lng[0]+d.lng[1]>360&&(d.lng[1]-=360,d.lng[0]-=360);var e=[d.lat[1]-d.lat[0],d.lng[1]-d.lng[0]],f=void 0,g=Math.min(e[0],e[1]);f=g>23?0:g>2.8?1:g>.7?2:g>.087?3:g>.022?4:g>.0027?5:6,(f>5||f<0)&&(f=-1);for(var h=12;h-- >0&&!(g_size[h][0]>e[0]/3&&g_size[h][1]>e[1]/3););h++;for(var i=void 0;;){h--;var j=g_size[h],k=encodeGeoHash((d.lat[0]+d.lat[1])/2,(d.lng[0]+d.lng[1])/2),l=k.substring(0,h);i=[l];var m=decodeGeoHash(l);if(m.lat[0]>c.lat[0]){if(m.lat[0]-j[0]>c.lat[0])continue;i=extend(i,"bottom")}if(m.lat[1]<c.lat[1]){if(m.lat[1]+j[0]<c.lat[1])continue;i=extend(i,"top")}if(m.lng[0]>c.lng[0]){if(m.lng[0]-j[1]>c.lng[0])continue;i=extend(i,"left")}if(m.lng[1]<c.lng[1]){if(m.lng[1]+j[1]<c.lng[1])continue;i=extend(i,"right")}break}geotiles[f]||(geotiles[f]={});var n={},o=!0,p=!1,q=void 0;try{for(var r,s=i[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var u=r.value;n[u]=geotiles[f][u]}}catch(a){p=!0,q=a}finally{try{!o&&s.return&&s.return()}finally{if(p)throw q}}var v=Object.keys(filter(n,function(a,b){return void 0===b?a:void 0})).map(function(a){return a});return v.length&&get("//www.parkour.org/map/query5j.php",{tiles:v.join(","),zoom:f}).then(function(a){Object.assign(geotiles[f],a),Object.assign(n,a),b(n)},function(){error(t("error_load_spotmap"))}),b(n),n}function b64a(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,function(a,b){return String.fromCharCode("0x"+b)}))}function getUser(){return localStorage.getItem("d8_user")}function getCredentials(){return localStorage.getItem("d8_auth")||"Basic Og=="}function setCredentials(a,b){localStorage.setItem("d8_user",a),localStorage.setItem("d8_auth","Basic "+b64a(a+":"+b))}function deleteCredentials(){localStorage.removeItem("d8_user"),localStorage.removeItem("d8_auth")}function http(a,b,c){var d=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return d.Authorization===!1?delete d.Authorization:d.user?(d.Authorization="Basic "+b64a(d.user+":"+d.pass),delete d.user,delete d.pass):b.match(/^(https?:)?\/\/(www\.)parkour\.org\/?/)&&(d.Authorization=getCredentials()),new Promise(function(e,f){var g=new XMLHttpRequest;g.open(a,b),g.onload=function(){if(this.status>=200&&this.status<300)try{e(JSON.parse(g.response))}catch(f){error(t("error_server_request")),e({method:a,url:b,params:c,headers:d,status:this.status,statusText:g.statusText,message:g.response})}else g.onerror()},g.onerror=function(){error(t("error_server_request"));var e={method:a,url:b,params:c,headers:d,status:this.status,statusText:g.statusText,message:g.response};f(e)},d&&Object.keys(d).forEach(function(a){g.setRequestHeader(a,d[a])}),c&&"object"===("undefined"==typeof c?"undefined":_typeof(c))?g.send(Object.keys(c).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(c[a])}).join("&")):g.send(c)})}function get(a,b,c){return b&&"object"===("undefined"==typeof b?"undefined":_typeof(b))?http("GET",a+(a.indexOf("?")>0?"&":"?")+Object.keys(b).map(function(a){return encodeURIComponent(a)+"="+encodeURIComponent(b[a])}).join("&"),void 0,c):b?http("GET",a+(a.indexOf("?")>0?"&":"?")+b,void 0,c):http("GET",a,b,c)}function post(a,b,c){return http("POST",a,b,c)}function patch(a,b,c){return http("PATCH",a,b,c)}function del(a,b,c){return http("REMOVE",a,b,c)}function setGpsObj(a){gpsObj&&gpsObj.setMap(null),gpsObj=new google.maps.Circle({strokeColor:"#0000FF",strokeOpacity:.4,strokeWeight:2,fillColor:"#0000FF",fillOpacity:.1,map:map,center:{lat:a.coords.latitude,lng:a.coords.longitude},radius:a.coords.accuracy,position:a})}function updateGpsObj(a){return(!gpsObj||gpsObj.position.coords.accuracy>a.coords.accuracy||gpsObj.position.timestamp<a.timestamp-3e3)&&(setGpsObj(a),!0)}function pan(a){map.panTo({lat:a.coords.latitude,lng:a.coords.longitude}),map.setZoom(a.coords.accuracy<200?17:a.coords.accuracy<500?16:a.coords.accuracy<2e3?15:13),google.maps.event.addListenerOnce(map,"idle",function(){map.panTo({lat:a.coords.latitude,lng:a.coords.longitude}),map.setZoom(a.coords.accuracy<200?17:a.coords.accuracy<500?16:a.coords.accuracy<2e3?15:13)})}function afterTrack(){}function track(a){"yes"===a&&(window.panToPosition=!0,goTab("map",0)),navigator.geolocation.getCurrentPosition(function(b){updateGpsObj(b)&&(a||Date.now<initial+1e4)&&("yes"===a||!location.hash.startsWith("#map")&&window.panToPosition)&&pan(b)},function(){},{timeout:250}),navigator.geolocation.getCurrentPosition(function(b){updateGpsObj(b)&&(a||Date.now<initial+1e4)&&("yes"===a||!location.hash.startsWith("#map")&&window.panToPosition)&&pan(b),afterTrack()},function(){afterTrack()},{enableHighAccuracy:!0})}function load(a){var b=new google.maps.Marker({id:a.id,map:map,title:""+a.title,position:{lat:a.lat,lng:a.lng},data:a,icon:a.type.startsWith("multi")?icons.zoom:a.type.includes("group")?icons.group:a.type.includes("event")?icons.event:icons.spot,shape:a.type.startsWith("multi")?shapes.zoom:shapes.spot});markers.push(b),google.maps.event.addListener(b,"click",show)}function show(a){if((!a||a.latLng||a.pixel)&&(a=this),"add"===a.data.category){if(isLite)return;map.panTo(a.getPosition()),infoWindow.setContent('\n            <button type="button" onclick="add(\'spot\')">&#x2795; '+t("spot")+'</button>\n            <button type="button" onclick="add(\'event\')">&#x2795; '+t("event")+'</button>\n            <button type="button" onclick="add(\'group\')">&#x2795; '+t("group")+"</button>"),infoWindow.open(map,a)}else a.data.category.startsWith("multi")?(infoWindow.close(),map.panTo(a.getPosition()),map.setZoom(map.getZoom()+2)):(infoWindow.setContent("<a onclick=\"navigate('#spot/"+a.data.id+'\');"><img class="type" src="'+icons[a.data.type].url+'">'+a.data.title+"</a>"),infoWindow.setPosition(a.getPosition()),infoWindow.open(map),getCloseNodes(a.data.lat,a.data.lng))}function loadAll(a){for(var b in markers)markers[b].setMap(null);markers=[];for(var c in a)for(var d in a[c])load(a[c][d])}function initMapInternal(){var a=location.hash,b=new google.maps.LatLngBounds({lat:49,lng:6},{lat:55,lng:15}),c={center:{lat:51.5167,lng:9.9167},zoom:7};if(map=new google.maps.Map(_("#map"),c),a.startsWith("#map/")){var d=/#(\w+)\/([^\/]*)\/([^\/]*)(?:\/([^\/]*))?/g.exec(a);map.setCenter({lat:parseFloat(d[2]),lng:parseFloat(d[3])}),d[4]&&map.setZoom(parseInt(d[4]))}else window.panToPosition?map.fitBounds(b):(map.setZoom(15),map.setCenter({lat:spots.spot.lat,lng:spots.spot.lng}));google.maps.event.addDomListener(window,"resize",function(){var a=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(a)}),google.maps.event.addListener(map,"bounds_changed",function(){var a=map.getBounds();loadBounds(a,window.intercept?window.intercept(window.drawRects,loadAll):loadAll);var b=map.getCenter(),c="#map/"+b.lat()+"/"+b.lng()+"/"+map.getZoom();location.hash==c||!location.hash.startsWith("#map/")&&""!=location.hash||history.replaceState({},"","#map/"+b.lat().toFixed(5)+"/"+b.lng().toFixed(5)+"/"+map.getZoom())}),google.maps.event.addListener(map,"click",newMarker);var e=document.createElement("div");new Filter(e,map);e.index=1,map.controls[google.maps.ControlPosition.LEFT_TOP].push(e),icons.event={url:"images/green.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},icons.group={url:"images/purple.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},icons.spot={url:"images/logo32.png",size:new google.maps.Size(32,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(15,31)},shapes.spot={coords:[15,0,31,7,15,31,0,7,15,0],type:"poly"},icons.zoom={url:"images/multi.png",size:new google.maps.Size(24,24),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(8,8)},shapes.zoom={coords:[11,0,14,1,16,3,18,5,18,13,18,15,24,20,24,23,15,19,7,18,1,15,0,7,3,2,7,0,11,0],type:"poly"},icons.crosshair={url:"images/crosshair.png",size:new google.maps.Size(49,49),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(24,24)},infoWindow=new google.maps.InfoWindow({content:"Some address here..",maxWidth:500,pixelOffset:new google.maps.Size(0,-31)}),track(!0),restore()}function newMarker(a,b){if(b||!isLite){if(!b&&map.getZoom()<14)return void success(t("zoom"));marker?marker.setPosition(a.latLng):(marker=new google.maps.Marker({position:a.latLng,map:map,title:t("new_marker"),icon:icons.crosshair,draggable:!isLite,data:{category:"add"}}),marker.addListener("drag",dragMarker),marker.addListener("dragend",endMarker),marker.addListener("click",show),show(marker)),dragMarker(),backup()}}function dragMarker(a){success(t("position")+": "+marker.getPosition().lat().toFixed(5)+" "+marker.getPosition().lng().toFixed(5))}function endMarker(a){map.panTo(marker.getPosition()),backup()}function clickMarker(a){show(marker)}function Filter(a,b){a.className="filterDiv";var c=document.createElement("div");c.className="filterBtn",c.innerHTML="&#9881;",a.appendChild(c);var d=document.createElement("div");d.className="filterBox vanish",a.appendChild(d),d.innerHTML='Zeige:<br /><span class="yes">'+t("spot")+'</span><br /><span class="no">'+t("event")+'</span><br /><span class="yes">'+t("group")+"</span>",c.addEventListener("click",function(){var a=_(".filterBox")[0];a.className="filterBox"==a.className?"filterBox vanish":"filterBox"})}function openTab(a,b){for(var c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_("#"+a).parentNode,d=_("section"),e=0;e<d.length;e++)d[e].parentNode===c&&("block"===d[e].style.display&&(console.log("Hiding  "+d[e].id),nav[d[e].id+"_hide"]&&nav[d[e].id+"_hide"](a==d[e].id)),d[e].style.display="none");if(b){for(var f=_("button"),g=0;g<f.length;g++)f[g].className=f[g].className.replace(" active","");b.currentTarget.className+=" active"}_("#"+a).style.display="block",console.log("Showing "+a),nav[a+"_show"]&&nav[a+"_show"]()}function goTab(a,b){openTab(a,void 0!==b?{currentTarget:_("button")[b]}:void 0)}function resetTab(){navigate("")}function notice(a,b){window.noticeHideTimeout&&noticeHide(),_("#notice").className=b+" show",_("#notice-text").innerText=a,window.noticeHideTimeout=window.setTimeout(noticeHide,4e3)}function error(a){notice(a,"error")}function success(a){notice(a,"success")}function noticeHide(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_("#notice").className+=a?" vanish":" hide",window.noticeHideTimeout&&(window.clearTimeout(window.noticeHideTimeout),delete window.noticeHideTimeout)}function navigate(a){if("string"==typeof a)return void(location.hash=a);if(a=location.hash,a.startsWith("#event/")||a.startsWith("#group/")||a.startsWith("#move/")||a.startsWith("#page/")||a.startsWith("#post/")||a.startsWith("#spot/")){var b=/#(\w+)\/(\d+)(?:\/(.*))?/g.exec(a);"lite"==b[3]&&(_("body")[0].className="lite",isLite=!0),loadSpot(b[2])}else if(a.startsWith("#login"))goTab("login",2);else if(a.startsWith("#search"))goTab("search",1),a.startsWith("#search/")&&(_("#search-text").value=/#(\w+)\/(.*)/g.exec(a)[2],loadSearch());else if((""==a||a.startsWith("#map/"))&&(goTab("map",0),a.startsWith("#map/"))){var c=/#(\w+)\/([^\/]*)\/([^\/]*)(?:\/([^\/]*))?/g.exec(a);map&&(map.panTo({lat:parseFloat(c[2]),lng:parseFloat(c[3])}),c[4]&&map.setZoom(parseInt(c[4])))}}function getCloseNodes(a,b){var c={lat:[a-1e-4,a+1e-4],lng:[b-1e-4,b+1e-4]};loadBounds(c,function(a){var b=[],d={spot:0,event:1,group:2};for(var e in a)for(var f in a[e]){var g=a[e][f];g.lat>c.lat[0]&&g.lat<c.lat[1]&&g.lng>c.lng[0]&&g.lng<c.lng[1]&&b.push(g)}var h="";b.sort(function(a,b){return d[a.type]-d[b.type]});for(var i in b){var j=b[i];h+='<a class="entry" onclick="navigate(\'#spot/'+j.id+'\');"><img class="type" src="'+icons[j.type].url+'">'+j.title+"</a>"}infoWindow.setContent(h)})}function loadSearch(){var a=_("#search-text").value;/^(0|[1-9]\d*)$/.test(a)?navigate("#spot/"+a):(search.data={_format:"hal_json",status:"All",type:"All",title:a,langcode:"All",page:0},get("//www.parkour.org/rest/content/node?status=All&type=All&title=&langcode=All&page=0",search.data,{Authorization:!1}).then(showPage))}function showPage(a){var b='<div class="grid">',c="",d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=void 0,k=!0,l=!1,m=void 0;try{for(var n,o=find("nid|\\d+|value",i)[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){var p=n.value;j=p}}catch(a){l=!0,m=a}finally{try{!k&&o.return&&o.return()}finally{if(l)throw m}}c+="<article onclick=\"navigate('#spot/"+j+"');\">",b+="<article onclick=\"navigate('#spot/"+j+"');\">";var q=!0,r=!1,s=void 0;try{for(var u,v=find("_links|.+parkour.org/rest/relation/node/.+/field_images|\\d+|href",i)[Symbol.iterator]();!(q=(u=v.next()).done);q=!0){var w=u.value;if(b+='<div class="in-place cover" style="background-image: url('+w+');"></div>',w)break}}catch(a){r=!0,s=a}finally{try{!q&&v.return&&v.return()}finally{if(r)throw s}}b+='<div class="in-place title">',_("#spot-title").innerText=t("no_title");var x=!0,y=!1,z=void 0;try{for(var A,B=find("title|\\d+|value",i)[Symbol.iterator]();!(x=(A=B.next()).done);x=!0){var C=A.value;c+="<h1>"+strip(C)+"</h1>",b+="<h1><span>"+strip(C)+"</span></h1>"}}catch(a){y=!0,z=a}finally{try{!x&&B.return&&B.return()}finally{if(y)throw z}}var D=!0,E=!1,F=void 0;try{for(var G,H=find("body|\\d+|value",i)[Symbol.iterator]();!(D=(G=H.next()).done);D=!0){var I=G.value;c+="<p>"+strip(I).substring(0,100)+"</p>",b+="<p><span>"+strip(I).substring(0,100)+"</span></p>"}}catch(a){E=!0,F=a}finally{try{!D&&H.return&&H.return()}finally{if(E)throw F}}var J=!0,K=!1,L=void 0;try{for(var M,N=find("_links|.+parkour.org/rest/relation/node/.+/field_images|\\d+|href",i)[Symbol.iterator]();!(J=(M=N.next()).done);J=!0){var O=M.value;if(c+='<img class="spot" src="'+O+'" />',O)break}}catch(a){K=!0,L=a}finally{try{!J&&N.return&&N.return()}finally{if(K)throw L}}b+="</div>",c+="</article>",b+="</article>"}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}b+="</div>",_("#search-page").innerHTML=b}function loadSpot(a){get("//www.parkour.org/"+l+"/rest/node/"+a,{_format:"hal_json"},{Authorization:!1}).then(function(b){spots.spot={id:a},_("#spot-type").innerText="";var c=!0,d=!1,e=void 0;try{for(var f,g=find("\\d+|type|\\d+|target_id",b)[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;_("#spot").className="spot-type-"+h,_("#spot-type").innerText=t("type_"+h)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}var i=!0,j=!1,k=void 0;try{for(var l,m=find("\\d+|field_spot_type|\\d+|value",b)[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value;_("#spot-type").innerText=t("spot_type_"+n)}}catch(a){j=!0,k=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw k}}var o=!0,p=!1,q=void 0;try{for(var r,s=find("\\d+|field_category|\\d+|value",b)[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var u=r.value;_("#spot-type").innerText=t("move_type_"+u)}}catch(a){p=!0,q=a}finally{try{!o&&s.return&&s.return()}finally{if(p)throw q}}var v=!0,w=!1,x=void 0;try{for(var y,z=find("\\d+|field_move_category|\\d+|value",b)[Symbol.iterator]();!(v=(y=z.next()).done);v=!0){var A=y.value;_("#spot-type").innerText=t("move_type_"+A)}}catch(a){w=!0,x=a}finally{try{!v&&z.return&&z.return()}finally{if(w)throw x}}var B=!0,C=!1,D=void 0;try{for(var E,F=find("\\d+|field_level|\\d+|value",b)[Symbol.iterator]();!(B=(E=F.next()).done);B=!0){var G=E.value;_("#spot-type").innerText+=" ("+t("move_type_"+G)+")"}}catch(a){C=!0,D=a}finally{try{!B&&F.return&&F.return()}finally{if(C)throw D}}var H=!0,I=!1,J=void 0;try{for(var K,L=find("\\d+|field_group_type|\\d+|value",b)[Symbol.iterator]();!(H=(K=L.next()).done);H=!0){var M=K.value;_("#spot-type").innerText=t("group_type_"+M)}}catch(a){I=!0,J=a}finally{try{!H&&L.return&&L.return()}finally{if(I)throw J}}var N=!0,O=!1,P=void 0;try{for(var Q,R=find("\\d+|field_event_type|\\d+|value",b)[Symbol.iterator]();!(N=(Q=R.next()).done);N=!0){var S=Q.value;_("#spot-type").innerText=t("event_type_"+S)}}catch(a){O=!0,P=a}finally{try{!N&&R.return&&R.return()}finally{if(O)throw P}}_("#spot-title").innerText=t("no_title");var T=!0,U=!1,V=void 0;try{for(var W,X=find("\\d+|title|\\d+|value",b)[Symbol.iterator]();!(T=(W=X.next()).done);T=!0){var Y=W.value;_("#spot-title").innerText=Y}}catch(a){U=!0,V=a}finally{try{!T&&X.return&&X.return()}finally{if(U)throw V}}_("#spot-body").innerText=t("no_body");var Z=!0,$=!1,aa=void 0;try{for(var ba,ca=find("\\d+|body|\\d+|value",b)[Symbol.iterator]();!(Z=(ba=ca.next()).done);Z=!0){var da=ba.value;_("#spot-body").innerHTML=da}}catch(a){$=!0,aa=a}finally{try{!Z&&ca.return&&ca.return()}finally{if($)throw aa}}var ea="",fa=!0,ga=!1,ha=void 0;try{for(var ia,ja=find("\\d+|_links|.+parkour.org/rest/relation/node/.+/field_images|\\d+|href",b)[Symbol.iterator]();!(fa=(ia=ja.next()).done);fa=!0){var ka=ia.value;ea+='<img src="'+ka+'" />'}}catch(a){ga=!0,ha=a}finally{try{!fa&&ja.return&&ja.return()}finally{if(ga)throw ha}}_("#spot-images").innerHTML=ea||t("no_images");var la=!0,ma=!1,na=void 0;try{for(var oa,pa=find("\\d+|field_location|\\d+|lat",b)[Symbol.iterator]();!(la=(oa=pa.next()).done);la=!0){var qa=oa.value;spots.spot.lat=qa,_("#spot-lat").innerHTML=qa}}catch(a){ma=!0,na=a}finally{try{!la&&pa.return&&pa.return()}finally{if(ma)throw na}}var ra=!0,sa=!1,ta=void 0;try{for(var ua,va=find("\\d+|field_location|\\d+|lon",b)[Symbol.iterator]();!(ra=(ua=va.next()).done);ra=!0){var wa=ua.value;spots.spot.lng=wa,_("#spot-lng").innerHTML=wa}}catch(a){sa=!0,ta=a}finally{try{!ra&&va.return&&va.return()}finally{if(sa)throw ta}}goTab("spot"),spots.spot.lat&&spots.spot.lng?(_("#spot-geo").style.display="block",_("#spot-map").style.display="inline",_("#spot-maps-form").style.display="inline",_(".addHere").forEach(function(a){return a.style.display="inline-block"}),_("#spot-maps-formdata").value=spots.spot.lat+","+spots.spot.lng,_("#map").style.display="block",_("#map").className="half",window.panToPosition=!1,google.maps.event.addListenerOnce(map,"idle",function(){google.maps.event.trigger(map,"resize"),map.setCenter({lat:spots.spot.lat,lng:spots.spot.lng}),map.setZoom(15)}),console.log(spots.spot),isLite&&newMarker({latLng:{lat:spots.spot.lat,lng:spots.spot.lng}},!0),google.maps.event.trigger(map,"resize"),map.setCenter({lat:spots.spot.lat,lng:spots.spot.lng}),map.setZoom(15)):(_("#spot-geo").style.display="none",_("#spot-map").style.display="none",_("#spot-maps-form").style.display="none",_(".addHere").forEach(function(a){return a.style.display="none"}))},function(a){console.log(a),error(t("error_load_spot"))})}function find(a,b){var c=[b];a=a.split("|");var d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=new RegExp("^"+i+"$"),k=[],l=!0,m=!1,n=void 0;try{for(var o,p=c[Symbol.iterator]();!(l=(o=p.next()).done);l=!0){var q=o.value;for(var r in q)q.hasOwnProperty(r)&&j.test(r)&&k.push(q[r])}}catch(a){m=!0,n=a}finally{try{!l&&p.return&&p.return()}finally{if(m)throw n}}c=k}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _iterator=_("*")[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var item=_step.value;item.dataset.translate&&(["input","textarea"].indexOf(item.tagName.toLowerCase())>=0?item.placeholder=t(item.dataset.translate):item.innerHTML=t(item.dataset.translate))}}catch(a){_didIteratorError=!0,_iteratorError=a}finally{try{!_iteratorNormalCompletion&&_iterator.return&&_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}document.addEventListener("DOMContentLoaded",navigate,!1),window.nav=void 0===window.nav?{}:window.nav,window.spots||(window.spots={spot:{},marker:{}}),nav.form_show=function(){_("#map").style.display="block",_("#map").className="half",map.setCenter(marker.getPosition()),google.maps.event.trigger(map,"resize"),google.maps.event.addListenerOnce(map,"idle",function(){google.maps.event.trigger(map,"resize"),map.setCenter(marker.getPosition())})},nav.form_hide=function(a){_("#map").className="",localStorage.getItem("form_text")&&!a&&success(t("draft_saved"))};var BITS=[16,8,4,2,1],BASE32="0123456789bcdefghjkmnpqrstuvwxyz",NEIGHBORS={right:{even:"bc01fg45238967deuvhjyznpkmstqrwx"},left:{even:"238967debc01fg45kmstqrwxuvhjyznp"},top:{even:"p0r21436x8zb9dcf5h7kjnmqesgutwvy"},bottom:{even:"14365h7k9dcfesgujnmqp0r2twvyx8zb"}},BORDERS={right:{even:"bcfguvyz"},left:{even:"0145hjnp"},top:{even:"prxz"},bottom:{even:"028b"}};NEIGHBORS.bottom.odd=NEIGHBORS.left.even,NEIGHBORS.top.odd=NEIGHBORS.right.even,NEIGHBORS.left.odd=NEIGHBORS.bottom.even,NEIGHBORS.right.odd=NEIGHBORS.top.even,BORDERS.bottom.odd=BORDERS.left.even,BORDERS.top.odd=BORDERS.right.even,BORDERS.left.odd=BORDERS.bottom.even,BORDERS.right.odd=BORDERS.top.even;var geotiles={},g_size=[[180,360],[45,45],[5.625,11.25],[1.40625,1.40625],[.17578125,.3515625],[.0439453125,.0439453125],[.0054931640625,.010986328125],[.001373291015625,.001373291015625],[.000171661376953125,.00034332275390625],[4291534423828125e-20,4291534423828125e-20],[5364418029785156e-21,10728836059570312e-21],[1341104507446289e-21,1341104507446289e-21],[1.6763806343078613e-7,3.3527612686157227e-7]];window.nav=void 0===window.nav?{}:window.nav,nav.login_show=function(){null!==getUser()?(goTab("logout-form"),_("#username").innerText=getUser()):goTab("login-form")},_("#login-submit").onclick=function(){var a=_("#login-username"),b=_("#login-password");setCredentials(a.value,b.value),success(t("logged_in_as",a.value)),a.value="",b.value="",nav.login_show()},_("#logout-submit").onclick=function(){deleteCredentials(),nav.login_show()},window.nav=void 0===window.nav?{}:window.nav,window.spots||(window.spots={spot:{},marker:{}}),nav.map_show=function(){if(window.google){var a=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(a)}};var map=void 0,marker=void 0,infoWindow=void 0,initial=Date.now;window.panToPosition=void 0===window.panToPosition?!location.hash.startsWith("#map/"):window.panToPosition;var gpsObj=void 0,icons={},shapes={},markers=[];window.mapScripts=!0,window.mapLoaded&&initMapInternal(),window.nav=void 0===window.nav?{}:window.nav;var isLite=!1;goTab("map",0),window.onhashchange=navigate,_("body")[0].onkeyup=function(a){27==a.which&&goTab("map",0)};var search={};_("#search-submit").onclick=function(){var a=_("#search-text").value;navigate(/^(0|[1-9]\d*)$/.test(a)?"#spot/"+a:"#search/"+a)},window.nav=void 0===window.nav?{}:window.nav,window.spots||(window.spots={spot:{},marker:{}}),nav.spot_hide=function(){_("#map").className=""},_("#spot-map").onclick=function(){navigate(""),map.setCenter({lat:spots.spot.lat,lng:spots.spot.lng}),map.setZoom(15)},_("#spot-web").onclick=function(){location.href="//www.parkour.org/"+l+"/node/"+spots.spot.id};